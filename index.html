<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Immobilien Kosten-Rechner</title>
    
    <!-- 
    IFRAME EMBEDDING EXAMPLE:
    To embed this calculator on immo-hrt.de or immo-hrt.com domains, use:
    
    <iframe
      src="https://immorechner.valoa.studio/index.html?theme=immo-hrt&embedded=true"
      title="Immobilien-Kostenrechner"
      width="100%"
      height="2150"
      style="border:0; background:transparent; display:block;"
      loading="lazy"
      referrerpolicy="origin"
      allow="scripts"
    />
    
    The ?theme=immo-hrt&embedded=true parameters ensure the correct styling
    even if automatic detection fails.
    -->
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- Chart.js from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        /* --- Grundlegende Stile & Variablen --- */
        :root {
            --bg-color: #F8F9FA;
            --primary-color: #005A9C; /* Seriöses Blau */
            --primary-dark: #004a80; /* Dunklerer Hover-Ton */
            --primary-rgb: 0, 90, 156; /* Für RGBA-Effekte */
            --primary-light: #e6f0f7;
            --text-color: #212529;
            --success-color: #198754; /* Dunkles Grün */
            --warning-color: #FD7E14; /* Warmes Orange */
            --warning-light: #ffe8d4;
            --border-color: #DEE2E6;
            --white: #FFFFFF;
            --font-family: 'Inter', sans-serif;
            /* Chart-Farben als Variablen (überschreibbar durch Themes) */
            --chart-primary: #005A9C;
            --chart-primary-light: #5ba0d8;
            --chart-warning: #FD7E14;
            --chart-warning-light: #fecba1;
        }

        /* --- Brand/Theme: immo-hrt (über URL ?theme=immo-hrt) --- */
        :root[data-theme="immo-hrt"] {
            /* Palette gemäß Style Guide */
            --bg-color: #F8F9FA;
            --primary-color: #C8A882; /* gold */
            --primary-dark: #B8956B; /* dark gold */
            --primary-rgb: 200, 168, 130;
            --primary-light: #E6D5B8; /* light gold */
            --primary-accent: #B8956B; /* dezent, kein kräftiges Orange */
            --text-color: #343A40; /* charcoal */
            --text-light: #6C757D; /* darkGray */
            --border-color: #E9ECEF; /* mediumGray */
            --success-color: #28A745;
            --warning-color: #FFC107; /* sanfter Amber */
            --warning-light: #FFF4D4;
            --shadow-strong: 0 8px 30px rgba(0, 0, 0, 0.12);
            --shadow-medium: 0 4px 16px rgba(0, 0, 0, 0.08);
            /* Sanfter Danger für kritisches Urteil */
            --danger-color: #B46A6A;
            --danger-rgb: 180, 106, 106;
            --danger-border: #D9A3A3;
            --danger-light: #F7ECEC;
            /* Chart Colors */
            --chart-primary: #C8A882;
            --chart-primary-light: #E6D5B8;
            --chart-warning: #FFC107;
            --chart-warning-light: #FFF4D4;
        }

        /* Komponentenspezifische Akzente für immo-hrt */
        :root[data-theme="immo-hrt"] .step-nav-button.primary,
        :root[data-theme="immo-hrt"] .language-toggle button.active,
        :root[data-theme="immo-hrt"] .cta-button,
        :root[data-theme="immo-hrt"] .mobile-start-button,
        :root[data-theme="immo-hrt"] .mobile-action-button.primary {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            border: none;
            box-shadow: var(--shadow-medium);
            color: #FFFFFF !important;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
            font-weight: 600;
            position: relative;
            overflow: hidden;
        }

        /* Glanz-Effekt für Buttons */
        :root[data-theme="immo-hrt"] .step-nav-button.primary::before,
        :root[data-theme="immo-hrt"] .cta-button::before,
        :root[data-theme="immo-hrt"] .mobile-start-button::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.3) 50%, transparent 70%);
            opacity: 0;
            transition: opacity 0.3s ease;
            border-radius: inherit;
            z-index: -1;
        }

        :root[data-theme="immo-hrt"] .cta-section {
            background: linear-gradient(135deg, var(--primary-light), rgba(var(--primary-rgb), 0.18));
            box-shadow: var(--shadow-medium);
            border: 1px solid rgba(var(--primary-rgb), 0.25);
        }

        /* Typografie mit POP - bessere Lesbarkeit */
        :root[data-theme="immo-hrt"] header h1 {
            font-size: clamp(2rem, 4vw, 3rem);
            font-weight: 800;
            line-height: 1.2;
            letter-spacing: -0.02em;
            color: var(--text-color);
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        :root[data-theme="immo-hrt"] header p {
            color: var(--text-light);
            font-weight: 500;
            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.8);
        }

        /* Secondary Buttons mit mehr Charakter */
        :root[data-theme="immo-hrt"] .step-nav-button.secondary,
        :root[data-theme="immo-hrt"] .mobile-action-button.secondary {
            background: linear-gradient(135deg, transparent, rgba(var(--primary-rgb), 0.05));
            color: var(--primary-dark);
            border: 2px solid var(--primary-color);
            box-shadow: 0 2px 8px rgba(var(--primary-rgb), 0.2);
            font-weight: 600;
        }

        /* Dezente Hover-Effekte für Premium-Feeling */
        :root[data-theme="immo-hrt"] .step-nav-button.primary:hover,
        :root[data-theme="immo-hrt"] .mobile-action-button.primary:hover,
        :root[data-theme="immo-hrt"] .cta-button:hover,
        :root[data-theme="immo-hrt"] .mobile-start-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 26px rgba(var(--primary-rgb), 0.22);
        }

        :root[data-theme="immo-hrt"] .step-nav-button.primary:hover::before,
        :root[data-theme="immo-hrt"] .cta-button:hover::before,
        :root[data-theme="immo-hrt"] .mobile-start-button:hover::before {
            opacity: 1;
        }

        /* Karten/Container mit Charakter - weniger glatt! */
        :root[data-theme="immo-hrt"] .container {
            box-shadow: var(--shadow-strong);
            border-radius: 16px;
            border: 1px solid rgba(var(--primary-rgb), 0.15);
            background: linear-gradient(135deg, #FFFFFF 0%, rgba(var(--primary-rgb), 0.02) 100%);
            position: relative;
        }

        /* Subtiler Noise-Effekt für mehr Textur */
        :root[data-theme="immo-hrt"] .container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(circle at 25% 25%, rgba(var(--primary-rgb), 0.05) 0%, transparent 50%),
                radial-gradient(circle at 75% 75%, rgba(var(--primary-rgb), 0.03) 0%, transparent 50%);
            border-radius: inherit;
            pointer-events: none;
            z-index: 0;
        }

        :root[data-theme="immo-hrt"] .mobile-result-summary,
        :root[data-theme="immo-hrt"] .mobile-breakdown {
            box-shadow: 0 8px 26px rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            border: 1px solid rgba(var(--primary-rgb), 0.18);
            background: linear-gradient(135deg, var(--primary-light) 0%, #FFFFFF 100%);
        }

        :root[data-theme="immo-hrt"] .trust-section {
            box-shadow: var(--shadow-medium);
            border-radius: 16px;
            border: 2px solid rgba(var(--primary-rgb), 0.25);
            background: linear-gradient(135deg, var(--primary-light) 0%, rgba(var(--primary-rgb), 0.08) 100%);
            position: relative;
            overflow: hidden;
        }

        /* Accent-Linie für Trust Section */
        :root[data-theme="immo-hrt"] .trust-section::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--primary-dark));
            border-radius: 16px 16px 0 0;
        }

        /* Bessere Lesbarkeit für alle Texte */
        :root[data-theme="immo-hrt"] h2,
        :root[data-theme="immo-hrt"] h3 {
            color: var(--text-color);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
            font-weight: 700;
        }

        :root[data-theme="immo-hrt"] p,
        :root[data-theme="immo-hrt"] span,
        :root[data-theme="immo-hrt"] label {
            color: var(--text-color);
            text-shadow: 0 1px 1px rgba(255, 255, 255, 0.5);
        }

        /* Inputs und Selects mit mehr Charakter */
        :root[data-theme="immo-hrt"] input,
        :root[data-theme="immo-hrt"] select {
            border: 2px solid rgba(var(--primary-rgb), 0.25);
            background: linear-gradient(135deg, #FFFFFF 0%, rgba(var(--primary-rgb), 0.02) 100%);
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.04);
            color: var(--text-color);
            font-weight: 500;
        }

        :root[data-theme="immo-hrt"] input:focus,
        :root[data-theme="immo-hrt"] select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(var(--primary-rgb), 0.2);
            outline: none;
        }

        /* Ergebnis-Zahlen mit mehr POP */
        :root[data-theme="immo-hrt"] .result-amount,
        :root[data-theme="immo-hrt"] .cost-amount {
            color: var(--primary-dark);
            font-weight: 800;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.08);
        }

        /* Softere Rot-Anmutung für kritisches Urteil (nur immo-hrt) */
        :root[data-theme="immo-hrt"] .klartext-urteil {
            box-shadow: 0 10px 28px rgba(0, 0, 0, 0.08);
            border-radius: 12px;
        }
        :root[data-theme="immo-hrt"] .urteil-rot {
            background-color: var(--danger-light);
            border: 2px solid var(--danger-border);
        }
        :root[data-theme="immo-hrt"] .urteil-rot .belastungsquote,
        :root[data-theme="immo-hrt"] .urteil-rot .urteil-text {
            color: var(--danger-color);
        }

        /* CTA im gelb/rot-Bereich dezenter und markenkonform */
        :root[data-theme="immo-hrt"] .cta-gelb-rot {
            background: linear-gradient(135deg, var(--primary-light), rgba(var(--primary-rgb), 0.14));
            border: 1px solid rgba(var(--primary-rgb), 0.25);
        }
        :root[data-theme="immo-hrt"] .cta-gelb-rot h2 { color: var(--text-color); }
        :root[data-theme="immo-hrt"] .cta-gelb-rot button {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: #FFFFFF;
            box-shadow: 0 8px 24px rgba(var(--primary-rgb), 0.22);
        }
        :root[data-theme="immo-hrt"] .cta-gelb-rot button:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 30px rgba(var(--primary-rgb), 0.28);
        }

        /* Sanierungskarten mit dezenter Schattierung */
        :root[data-theme="immo-hrt"] .sanierung-item:hover {
            background-color: #FBF7F0;
            box-shadow: 0 6px 18px rgba(var(--primary-rgb), 0.12);
        }
        :root[data-theme="immo-hrt"] .sanierung-item.selected {
            background-color: var(--primary-light);
            box-shadow: 0 10px 26px rgba(var(--primary-rgb), 0.16);
        }

        /* Sanierungskosten-Preisbadge: bessere Lesbarkeit und Markenbezug */
        :root[data-theme="immo-hrt"] .sanierung-cost {
            color: var(--text-color);
            background-color: rgba(var(--primary-rgb), 0.14);
            border: 1px solid rgba(var(--primary-rgb), 0.28);
            padding: 0.2rem 0.55rem;
            border-radius: 10px;
            font-weight: 700;
            font-size: 1rem;
            line-height: 1.3;
            font-variant-numeric: tabular-nums;
            -moz-font-feature-settings: "tnum" 1;
            -webkit-font-feature-settings: "tnum" 1;
            font-feature-settings: "tnum" 1;
            box-shadow: 0 2px 8px rgba(var(--primary-rgb), 0.12);
        }
        :root[data-theme="immo-hrt"] .sanierung-item.selected .sanierung-cost {
            background-color: rgba(var(--primary-rgb), 0.18);
            border-color: rgba(var(--primary-rgb), 0.35);
            box-shadow: 0 3px 10px rgba(var(--primary-rgb), 0.16);
        }

        /* Subtiles Header-Shadow für klare Trennung */
        :root[data-theme="immo-hrt"] header {
            box-shadow: 0 2px 16px rgba(0, 0, 0, 0.06);
        }

        /* --- Iframe-Specific Styles --- */
        :root[data-embedded="true"] body {
            padding: 1rem;
            background: transparent;
        }

        :root[data-embedded="true"] .container {
            max-width: 100%;
            box-shadow: none;
            border-radius: 8px;
            margin: 0;
        }

        :root[data-embedded="true"] header {
            padding: 1rem 0;
            text-align: center;
        }

        :root[data-embedded="true"] header h1 {
            font-size: clamp(1.5rem, 3vw, 2.2rem);
            margin-bottom: 0.5rem;
        }

        :root[data-embedded="true"] .language-toggle {
            position: static;
            margin-bottom: 1rem;
            justify-content: center;
        }

        /* immo-hrt: Sprachumschalter oben rechts halten, auch im Iframe */
        :root[data-theme="immo-hrt"] header {
            padding-top: 3rem; /* mehr Luft über Titel/Untertitel/Toggle */
            padding-bottom: 2.25rem;
        }
        :root[data-theme="immo-hrt"][data-embedded="true"] header {
            padding-top: 2rem;  /* im Iframe etwas kompakter, aber mehr als Standard */
            padding-bottom: 1.75rem;
        }
        :root[data-theme="immo-hrt"][data-embedded="true"] .language-toggle {
            position: absolute;
            top: 1rem;
            right: 1rem;
            margin-bottom: 0;
            justify-content: flex-start;
            width: auto;
        }

        :root[data-embedded="true"] .trust-section {
            margin: 2rem 0 1rem 0;
            padding: 1.5rem;
        }

        /* Combined iframe + immo-hrt theme styles */
        :root[data-theme="immo-hrt"][data-embedded="true"] .container {
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.06);
            border: 1px solid rgba(200, 168, 130, 0.2);
        }

        :root[data-theme="immo-hrt"][data-embedded="true"] header h1 {
            color: var(--primary-color);
            font-weight: 700;
        }

        :root[data-theme="immo-hrt"][data-embedded="true"] .cta-section {
            background: linear-gradient(135deg, var(--primary-light), rgba(var(--primary-rgb), 0.1));
            border-radius: 8px;
        }

        /* Iframe responsive adjustments */
        @media (max-width: 768px) {
            :root[data-embedded="true"] body {
                padding: 0.5rem;
            }
            
            :root[data-embedded="true"] .container {
                border-radius: 4px;
            }

            :root[data-embedded="true"] header h1 {
                font-size: clamp(1.2rem, 4vw, 1.8rem);
            }
        }

        /* Ensure iframe content fits properly */
        :root[data-embedded="true"] .mobile-step-navigation {
            max-height: calc(100vh - 100px);
            overflow-y: auto;
        }

        :root[data-embedded="true"] .step-modal {
            max-height: none;
            height: auto;
        }

        /* --- Reset & Body --- */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 2rem 1rem;
        }

        /* --- Hauptcontainer & Layout --- */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: var(--white);
            border-radius: 12px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }

        header {
            padding: 2rem;
            border-bottom: 1px solid var(--border-color);
            text-align: center;
            position: relative;
        }

        header h1 {
            color: var(--primary-color);
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        header p {
            font-size: 1.1rem;
            color: #6c757d;
        }
        
        .rechner-wrapper {
            display: flex;
            flex-wrap: wrap;
        }

        .input-section, .output-section {
            padding: 2rem;
            width: 100%;
        }

        .input-section {
            background-color: #fdfdff;
        }
        
        /* --- Formular-Elemente --- */
        .form-group {
            margin-bottom: 2rem;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .form-group .label-wrapper {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .form-group .live-value {
            font-weight: 700;
            color: var(--primary-color);
            font-size: 1.1rem;
            background-color: var(--primary-light);
            padding: 0.25rem 0.75rem;
            border-radius: 6px;
        }

        .form-group .info-text {
            font-size: 0.85rem;
            color: #6c757d;
            margin-top: 0.25rem;
        }

        input[type="number"], select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            font-family: var(--font-family);
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        input[type="number"]:focus, select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(var(--primary-rgb), 0.2);
        }

        /* Slider Stile */
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 5px;
            outline: none;
            margin-top: 0.5rem;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: var(--primary-color);
            cursor: pointer;
            border-radius: 50%;
            border: 2px solid var(--white);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: var(--primary-color);
            cursor: pointer;
            border-radius: 50%;
            border: 2px solid var(--white);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        /* Checkbox Stile */
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: 1.25em;
            height: 1.25em;
            accent-color: var(--primary-color);
        }
        
        .makler-provision-rate {
            transition: opacity 0.3s, transform 0.3s;
            transform: translateY(-10px);
            opacity: 0;
            height: 0;
            overflow: hidden;
        }
        
        .makler-provision-rate.visible {
            transform: translateY(0);
            opacity: 1;
            height: auto;
            margin-top: 1rem;
        }

        /* --- Phase 2 (Monatliche Belastung) --- */
        .phase-2 {
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 2px solid var(--border-color);
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s ease;
        }
        
        .phase-2.visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        .phase-2 h3 {
            color: var(--primary-color);
            font-size: 1.3rem;
            margin-bottom: 1.5rem;
            font-weight: 700;
        }
        
        /* Sanierungskosten Checkboxen */
        .sanierung-checkboxes {
            display: grid;
            gap: 1rem;
        }
        
        .sanierung-item {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            transition: all 0.2s ease;
            cursor: pointer;
            user-select: none;
            position: relative;
        }
        
        .sanierung-item:hover {
            background-color: #f8f9fa;
            border-color: var(--primary-color);
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(var(--primary-rgb), 0.1);
        }
        
        .sanierung-item.selected {
            background-color: var(--primary-light);
            border-color: var(--primary-color);
            box-shadow: 0 2px 8px rgba(var(--primary-rgb), 0.15);
        }
        
        .sanierung-item input[type="checkbox"] {
            margin-top: 0.125rem;
        }
        
        .sanierung-details {
            flex: 1;
        }
        
        .sanierung-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        
        .sanierung-cost {
            color: var(--warning-color);
            font-weight: 700;
            font-size: 1.1rem;
        }
        
        /* Tooltips */
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }
        
        .tooltip .info-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 16px;
            height: 16px;
            background-color: var(--primary-color);
            color: white;
            border-radius: 50%;
            font-size: 0.7rem;
            font-weight: bold;
            margin-left: 0.25rem;
        }
        
        .tooltip .tooltip-text {
            visibility: hidden;
            width: 200px;
            background-color: #333;
            color: #fff;
            text-align: left;
            border-radius: 6px;
            padding: 0.5rem;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.8rem;
            line-height: 1.3;
        }
        
        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
        
        /* Warnhinweis */
        .warning-box {
            background-color: var(--warning-light);
            border: 1px solid var(--warning-color);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
            display: none;
        }
        
        .warning-box.visible {
            display: block;
        }
        
        .warning-box .warning-title {
            font-weight: 700;
            color: var(--warning-color);
            margin-bottom: 0.5rem;
        }
        
        /* --- Einkommen & Klartext-Urteil --- */
        .einkommen-section {
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 2px solid var(--border-color);
        }
        
        .einkommen-section h3 {
            color: var(--primary-color);
            font-size: 1.3rem;
            margin-bottom: 1rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary-light) 0%, rgba(var(--primary-rgb), 0.15) 100%);
            padding: 1rem;
            border-radius: 8px;
            border-left: 4px solid var(--primary-color);
            box-shadow: 0 2px 8px rgba(var(--primary-rgb), 0.1);
        }
        
        .klartext-urteil {
            margin-top: 2rem;
            padding: 2rem;
            border-radius: 12px;
            text-align: center;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s ease;
        }
        
        .klartext-urteil.visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        .belastungsquote {
            font-size: 4rem;
            font-weight: 700;
            margin: 1rem 0;
        }
        
        .urteil-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        
        .urteil-text {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }
        
        .urteil-beschreibung {
            font-size: 1rem;
            line-height: 1.5;
            margin-bottom: 1rem;
        }
        
        .zusatz-info {
            font-size: 0.9rem;
            color: #6c757d;
            margin-top: 1rem;
            font-style: italic;
        }
        
        /* Urteil-Farben */
        .urteil-gruen {
            background-color: #d4edda;
            border: 2px solid var(--success-color);
        }
        
        .urteil-gruen .belastungsquote {
            color: var(--success-color);
        }
        
        .urteil-gelb {
            background-color: var(--warning-light);
            border: 2px solid var(--warning-color);
        }
        
        .urteil-gelb .belastungsquote {
            color: var(--warning-color);
        }
        
        .urteil-rot {
            background-color: #f8d7da;
            border: 2px solid #dc3545;
        }
        
        .urteil-rot .belastungsquote {
            color: #dc3545;
        }
        
        /* --- Dynamischer CTA --- */
        .dynamic-cta {
            margin-top: 3rem;
            padding: 2.5rem;
            border-radius: 12px;
            text-align: center;
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.6s ease;
        }
        
        .dynamic-cta.visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        .dynamic-cta h2 {
            font-size: 1.8rem;
            margin-bottom: 1rem;
            font-weight: 700;
        }
        
        .dynamic-cta p {
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 2rem;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .dynamic-cta .form-inline {
            display: flex;
            gap: 1rem;
            max-width: 400px;
            margin: 0 auto;
            flex-wrap: wrap;
        }
        
        .dynamic-cta input[type="email"] {
            flex: 1;
            min-width: 250px;
            padding: 1rem;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
        }
        
        .dynamic-cta button {
            padding: 1rem 2rem;
            border: none;
            border-radius: 8px;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
        }
        
        .cta-gruen {
            background-color: #d4edda;
            border: 2px solid var(--success-color);
        }
        
        .cta-gruen h2 {
            color: var(--success-color);
        }
        
        .cta-gruen button {
            background-color: var(--success-color);
            color: white;
        }
        
        .cta-gruen button:hover {
            background-color: #157347;
            transform: translateY(-2px);
        }
        
        .cta-gelb-rot {
            background-color: var(--warning-light);
            border: 2px solid var(--warning-color);
        }
        
        .cta-gelb-rot h2 {
            color: var(--warning-color);
        }
        
        .cta-gelb-rot button {
            background-color: var(--warning-color);
            color: white;
        }
        
        .cta-gelb-rot button:hover {
            background-color: #e8680a;
            transform: translateY(-2px);
        }

        /* --- Output / Ergebnis-Sektion --- */
        .output-section {
            background-color: var(--white);
            border-left: 1px solid var(--border-color);
        }
        
        .results-summary {
            text-align: center;
            margin-bottom: 2.5rem;
        }
        
        .results-summary h3 {
            font-size: 1rem;
            font-weight: 600;
            color: #6c757d;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .results-summary .total-investment {
            font-size: 3rem;
            font-weight: 700;
            color: var(--success-color);
            margin: 0.5rem 0;
        }
        
        /* --- Reference Costs (Zur Orientierung) --- */
        .reference-costs {
            margin-top: 2rem;
            padding: 1.5rem;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }
        
        .reference-costs h4 {
            font-size: 0.9rem;
            font-weight: 600;
            color: #6c757d;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 1rem;
        }
        
        .reference-costs ul {
            list-style: none;
            padding: 0;
        }
        
        .reference-costs li {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            font-size: 0.9rem;
            color: #6c757d;
        }
        
        .reference-costs .cost-value {
            font-weight: 600;
            color: var(--text-color);
        }
        
        .chart-container {
            position: relative;
            height: 280px;
            width: 280px;
            margin: 0 auto 2.5rem auto;
        }
        
        .cost-breakdown ul {
            list-style: none;
            padding: 0;
        }
        
        .cost-breakdown li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            min-height: 3rem;
            padding: 0.75rem 0;
            border-bottom: 1px solid #f1f3f5;
        }
        
        .cost-breakdown li:last-child {
            border-bottom: none;
        }
        
        .cost-breakdown .cost-label {
            color: #495057;
        }
        
        .cost-breakdown .cost-value {
            font-weight: 600;
        }
        
        .cost-breakdown .highlight {
            color: var(--warning-color);
        }
        
        .cost-breakdown .total {
            font-weight: 700;
            font-size: 1.1rem;
            padding-top: 1rem;
        }
        
        .cost-breakdown .final-total .cost-value {
            color: var(--success-color);
        }
        
        hr.divider {
            border: 0;
            height: 1px;
            background-color: var(--border-color);
            margin: 1rem 0;
        }

        /* --- CTA Sektion --- */
        .cta-section {
            background-color: var(--primary-light);
            padding: 2.5rem;
            text-align: center;
            border-top: 1px solid var(--border-color);
        }
        
        .cta-section h2 {
            color: var(--primary-color);
            margin-bottom: 1rem;
        }
        
        .cta-section p {
            max-width: 600px;
            margin: 0 auto 1.5rem auto;
        }
        
        .cta-button {
            display: inline-block;
            background-color: var(--primary-color);
            color: var(--white);
            padding: 0.8rem 2rem;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            transition: background-color 0.2s, transform 0.2s;
            box-shadow: 0 4px 15px rgba(var(--primary-rgb), 0.2);
        }
        
        .cta-button:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
        }
        
        .cta-buyer-form {
            margin-top: 2rem;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .cta-buyer-form p {
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }
        
        .cta-buyer-form .form-inline {
            display: flex;
            gap: 0.5rem;
        }
        
        .cta-buyer-form input[type="email"] {
            flex-grow: 1;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
        }
        
        .cta-buyer-form button {
            background-color: var(--success-color);
            color: var(--white);
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.2s;
        }
        
        .cta-buyer-form button:hover {
            background-color: #146c43;
        }
        
        /* --- Vertrauensfoto & Kalendertermin --- */
        .trust-section {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 2rem;
            margin: 2rem 0 3rem 0;
            flex-wrap: wrap;
            background-color: var(--white);
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }
        
        .trust-photo {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--primary-color);
            box-shadow: 0 4px 15px rgba(var(--primary-rgb), 0.2);
        }
        
        .calendar-cta {
            text-align: left;
        }
        
        .calendar-button {
            display: block;
            background-color: var(--success-color);
            color: var(--white);
            padding: 1rem 2.5rem;
            border-radius: 8px;
            border: none;
            text-decoration: none;
            font-weight: 600;
            font-size: 1.1rem;
            font-family: var(--font-family);
            cursor: pointer;
            transition: background-color 0.2s, transform 0.2s;
            box-shadow: 0 4px 15px rgba(25, 135, 84, 0.3);
            margin-top: 1rem;
            text-align: center;
            width: 100%;
        }
        
        .calendar-button:hover {
            background-color: #146c43;
            transform: translateY(-2px);
        }
        
        .calendar-text {
            font-size: 1.1rem;
            color: var(--text-color);
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .calendar-subtext {
            font-size: 0.9rem;
            color: #6c757d;
            margin-bottom: 0.5rem;
        }
        
        /* CTA Buttons Layout */
        .cta-buttons-section {
            margin: 2rem 0;
        }
        
        /* --- Language Toggle --- */
        .language-toggle {
            position: absolute;
            top: 1rem;
            right: 1rem;
            display: flex;
            background-color: var(--white);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .language-toggle button {
            background: none;
            border: none;
            padding: 0.5rem 0.75rem;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }
        
        .language-toggle button:hover {
            background-color: var(--primary-light);
        }
        
        .language-toggle button.active {
            background-color: var(--primary-color);
            color: var(--white);
        }
        
        .language-toggle button.active:hover {
            background-color: var(--primary-dark);
        }
        
        /* Mobile Step Navigation */
        .mobile-step-navigation {
            display: none;
        }
        
        .mobile-start-button {
            display: none;
        }
        
        .mobile-results-page {
            display: none;
        }
        
        @media (max-width: 991px) {
            .mobile-step-navigation.active {
                display: block;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.9);
                z-index: 1000;
                backdrop-filter: blur(5px);
            }
            
            .step-modal {
                position: absolute;
                top: 2rem;
                left: 1rem;
                right: 1rem;
                bottom: 2rem;
                background: var(--white);
                padding: 1.5rem;
                border-radius: 12px;
                overflow-y: auto;
                box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
                display: flex;
                flex-direction: column;
            }
            
            .step-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 1.5rem;
                padding-bottom: 1rem;
                border-bottom: 2px solid var(--border-color);
                flex-shrink: 0;
            }
            
            .step-content {
                flex: 1;
                overflow-y: auto;
                padding-right: 0.5rem;
            }
            
            .step-title {
                font-size: 1.2rem;
                font-weight: 700;
                color: var(--primary-color);
            }
            
            .step-close {
                background: none;
                border: none;
                font-size: 1.5rem;
                cursor: pointer;
                padding: 0.5rem;
                border-radius: 50%;
                transition: background-color 0.2s;
            }
            
            .step-close:hover {
                background-color: var(--primary-light);
            }
            
            .step-navigation {
                display: flex;
                justify-content: space-between;
                margin-top: 2rem;
                padding-top: 1rem;
                border-top: 1px solid var(--border-color);
                flex-shrink: 0;
            }
            
            .step-nav-button {
                padding: 0.75rem 1.5rem;
                border: none;
                border-radius: 8px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.2s;
            }
            
            .step-nav-button.primary {
                background-color: var(--primary-color);
                color: var(--white);
            }
            
            .step-nav-button.primary:hover {
                background-color: var(--primary-dark);
            }
            
            .step-nav-button.secondary {
                background-color: var(--border-color);
                color: var(--text-color);
            }
            
            .step-nav-button.secondary:hover {
                background-color: #adb5bd;
            }
            
            .step-nav-button:disabled {
                opacity: 0.5;
                cursor: not-allowed;
            }
            
            .mobile-start-button {
                display: block !important;
                position: fixed;
                bottom: 2rem;
                right: 2rem;
                background-color: var(--primary-color);
                color: var(--white);
                border: none;
                padding: 1rem 2rem;
                border-radius: 50px;
                font-weight: 700;
                font-size: 1.1rem;
                cursor: pointer;
                box-shadow: 0 4px 20px rgba(var(--primary-rgb), 0.3);
                transition: all 0.2s;
                z-index: 100;
            }
            
            .mobile-start-button:hover {
                background-color: var(--primary-dark);
                transform: translateY(-2px);
                box-shadow: 0 6px 25px rgba(var(--primary-rgb), 0.4);
            }
            
            .rechner-wrapper {
                display: none;
            }
            
            .rechner-wrapper.desktop-only {
                display: block;
            }
            
            .mobile-results-page.active {
                display: block;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: var(--bg-color);
                z-index: 1001;
                overflow-y: auto;
            }
            
            .mobile-results-container {
                padding: 1rem;
                max-width: 600px;
                margin: 0 auto;
            }
            
            .results-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 1rem 0 2rem 0;
                border-bottom: 2px solid var(--border-color);
                margin-bottom: 2rem;
            }
            
            .results-header h2 {
                color: var(--primary-color);
                font-size: 1.5rem;
                margin: 0;
            }
            
            .results-close {
                background: none;
                border: none;
                font-size: 2rem;
                cursor: pointer;
                padding: 0.5rem;
                border-radius: 50%;
                transition: background-color 0.2s;
            }
            
            .results-close:hover {
                background-color: var(--primary-light);
            }
            
            .mobile-result-summary {
                text-align: center;
                padding: 2rem;
                background: var(--white);
                border-radius: 12px;
                margin-bottom: 2rem;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            }
            
            .result-title {
                font-size: 1rem;
                color: #6c757d;
                font-weight: 600;
                text-transform: uppercase;
                letter-spacing: 0.5px;
                margin-bottom: 1rem;
            }
            
            .result-amount {
                font-size: 2.5rem;
                font-weight: 700;
                color: var(--success-color);
            }
            
            .mobile-verdict {
                margin: 2rem 0;
                padding: 2rem;
                border-radius: 12px;
                text-align: center;
            }
            
            .mobile-breakdown {
                background: var(--white);
                border-radius: 12px;
                padding: 1.5rem;
                margin-bottom: 2rem;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            }
            
            .mobile-breakdown h3 {
                color: var(--primary-color);
                margin-bottom: 1rem;
                font-size: 1.2rem;
            }
            
            .breakdown-item {
                display: flex;
                justify-content: space-between;
                padding: 0.75rem 0;
                border-bottom: 1px solid var(--border-color);
            }
            
            .breakdown-item:last-child {
                border-bottom: none;
                font-weight: 700;
                font-size: 1.1rem;
            }
            
            .mobile-results-actions {
                display: flex;
                gap: 1rem;
                margin-top: 2rem;
            }
            
            .mobile-action-button {
                flex: 1;
                padding: 1rem;
                border: none;
                border-radius: 8px;
                font-weight: 600;
                font-size: 1rem;
                cursor: pointer;
                transition: all 0.2s;
            }
            
            .mobile-action-button.secondary {
                background-color: var(--border-color);
                color: var(--text-color);
            }
            
            .mobile-action-button.secondary:hover {
                background-color: #adb5bd;
            }
            
            .mobile-action-button.primary {
                background-color: var(--primary-color);
                color: var(--white);
            }
            
            .mobile-action-button.primary:hover {
                background-color: var(--primary-dark);
            }
            
            /* Mobile Tooltip Override */
            .mobile-step-navigation .tooltip .tooltip-text {
                position: fixed !important;
                z-index: 2000 !important;
                bottom: auto !important;
                top: 50% !important;
                left: 50% !important;
                transform: translate(-50%, -50%) !important;
                width: 80vw !important;
                max-width: 300px !important;
                background-color: rgba(0, 0, 0, 0.9) !important;
                color: white !important;
                border-radius: 8px !important;
                padding: 1rem !important;
                font-size: 0.9rem !important;
                text-align: center !important;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5) !important;
            }

            /* Calendar Popup Styles */
            .calendar-popup-overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.8);
                z-index: 10000;
                display: flex;
                align-items: center;
                justify-content: center;
                opacity: 0;
                visibility: hidden;
                transition: all 0.3s ease;
            }

            .calendar-popup-overlay.active {
                opacity: 1;
                visibility: visible;
            }

            .calendar-popup-content {
                background: var(--white);
                border-radius: 16px;
                width: 90vw;
                max-width: 500px;
                max-height: 90vh;
                overflow-y: auto;
                transform: scale(0.9);
                transition: transform 0.3s ease;
                box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            }

            .calendar-popup-overlay.active .calendar-popup-content {
                transform: scale(1);
            }

            .calendar-popup-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 2rem 2rem 1rem 2rem;
                border-bottom: 1px solid var(--border-color);
            }

            .calendar-popup-header h3 {
                color: var(--primary-color);
                margin: 0;
                font-size: 1.4rem;
                font-weight: 700;
            }

            .calendar-close-btn {
                background: none;
                border: none;
                font-size: 2rem;
                color: #6c757d;
                cursor: pointer;
                padding: 0.5rem;
                border-radius: 50%;
                transition: all 0.2s;
                width: 3rem;
                height: 3rem;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .calendar-close-btn:hover {
                background-color: var(--border-color);
                color: var(--text-color);
            }

            .calendar-popup-body {
                padding: 2rem;
            }

            .calendar-popup-body > p {
                color: var(--text-color);
                margin-bottom: 2rem;
                font-size: 1.1rem;
            }

            .calendar-embed-container {
                border-radius: 12px;
                overflow: hidden;
                background: #f8f9fa;
                border: 1px solid var(--border-color);
                min-height: 600px;
            }

            .calendar-embed-container iframe {
                border-radius: 12px;
            }

            body.popup-open {
                overflow: hidden;
            }
        }
        
        /* Mobile Language Toggle */
        @media (max-width: 991px) {
            .language-toggle {
                position: static;
                margin: 0 auto 1rem auto;
                width: fit-content;
            }
        }

        /* --- Responsive Design --- */
        @media (min-width: 992px) {
            .rechner-wrapper {
                flex-wrap: nowrap;
            }
            .input-section {
                width: 45%;
                border-right: 1px solid var(--border-color);
            }
            .output-section {
                width: 55%;
                border-left: none;
            }
        }

    </style>
    <script>
      // Early theme switch: enable immo-hrt only when hosted on or embedded by immo-hrt.de/.com
      (function() {
        try {
          var allowed = ['immo-hrt.de', 'immo-hrt.com'];
          var host = (window.location.hostname || '').toLowerCase();
          var ref = (document.referrer || '').toLowerCase();
          var params = new URLSearchParams(window.location.search);
          
          // Check URL parameters first (most reliable)
          var forceTheme = params.get('theme') === 'immo-hrt';
          var forceEmbedded = params.get('embedded') === 'true';
          
          // Check domain/referrer
          var matchesHost = allowed.some(function(d){ return host === d || host.endsWith('.' + d); });
          var matchesRef = allowed.some(function(d){ return ref.indexOf(d) !== -1; });
          
          // Check if embedded in iframe from allowed domains
          var isInIframe = window.self !== window.top;
          var parentMatches = false;
          if (isInIframe) {
            try {
              // Try to access parent domain (will throw error if cross-origin)
              var parentHost = window.parent.location.hostname.toLowerCase();
              parentMatches = allowed.some(function(d){ return parentHost === d || parentHost.endsWith('.' + d); });
            } catch (e) {
              // Cross-origin iframe - check referrer instead
              parentMatches = matchesRef;
            }
          }
          
          // Apply theme if forced via URL or domain matches
          if (forceTheme || matchesHost || matchesRef || parentMatches) {
            document.documentElement.setAttribute('data-theme', 'immo-hrt');
          }
          
          // Apply embedded styling if forced via URL or actually in iframe
          if (forceEmbedded || isInIframe) {
            document.documentElement.setAttribute('data-embedded', 'true');
          }
          
        } catch (_) {}
      })();
    </script>
</head>
<body>

    <div class="container">
        <header>
            <div class="language-toggle">
                <button id="lang-de" class="active" onclick="switchLanguage('de')">
                    🇩🇪 DE
                </button>
                <button id="lang-en" onclick="switchLanguage('en')">
                    🇬🇧 EN
                </button>
            </div>
            <h1 data-de="Immobilien Kosten-Rechner" data-en="Real Estate Truth Cost Calculator">Immobilien Kosten-Rechner</h1>
            <p data-de="Kannst du dir das leisten? Das ist die einzige Frage, die dir die Bank am Ende stellen wird." data-en="Can you afford it? That's the only question the bank will ask you in the end.">Kannst du dir das leisten? Das ist die einzige Frage, die dir die Bank am Ende stellen wird.</p>
        </header>

        <!-- Mobile Step Navigation -->
        <div class="mobile-step-navigation" id="mobile-step-navigation">
            <div class="step-modal">
                <div class="step-header">
                    <div class="step-title" id="step-title">Schritt 1</div>
                    <button class="step-close" onclick="closeMobileSteps()">&times;</button>
                </div>
                <div class="step-content" id="step-content">
                    <!-- Content wird dynamisch eingefügt -->
                </div>
                <div class="step-navigation">
                    <button class="step-nav-button secondary" id="prev-button" onclick="previousStep()" data-de="Zurück" data-en="Back">Zurück</button>
                    <button class="step-nav-button primary" id="next-button" onclick="nextStep()" data-de="Weiter" data-en="Next">Weiter</button>
                </div>
            </div>
        </div>

        <!-- Mobile Start Button -->
        <button class="mobile-start-button" id="mobile-start-button" onclick="startMobileSteps()" data-de="Rechner starten" data-en="Start Calculator">Rechner starten</button>

        <!-- Mobile Results Page -->
        <div class="mobile-results-page" id="mobile-results-page">
            <div class="mobile-results-container">
                <div class="results-header">
                    <h2 data-de="Ihr Ergebnis" data-en="Your Result">Ihr Ergebnis</h2>
                    <button class="results-close" onclick="closeMobileResults()">&times;</button>
                </div>
                
                <div class="mobile-results-content">
                    <!-- Hauptergebnis -->
                    <div class="mobile-result-summary">
                        <div class="result-title" data-de="Monatliche Gesamtbelastung" data-en="Total Monthly Burden">Monatliche Gesamtbelastung</div>
                        <div id="mobile-monthly-total" class="result-amount">0 € / Monat</div>
                    </div>
                    
                    <!-- Klartext-Urteil -->
                    <div id="mobile-klartext-result" class="mobile-verdict">
                        <!-- Wird dynamisch befüllt -->
                    </div>
                    
                    <!-- Kostenaufschlüsselung -->
                    <div class="mobile-breakdown">
                        <h3 data-de="Aufschlüsselung" data-en="Breakdown">Aufschlüsselung</h3>
                        <div class="breakdown-item">
                            <span data-de="Finanzierung" data-en="Financing">Finanzierung</span>
                            <span id="mobile-result-financing">0 €</span>
                        </div>
                        <div class="breakdown-item">
                            <span data-de="Hausgeld" data-en="Maintenance">Hausgeld</span>
                            <span id="mobile-result-hausgeld">0 €</span>
                        </div>
                        <div class="breakdown-item">
                            <span data-de="Grundsteuer" data-en="Property Tax">Grundsteuer</span>
                            <span id="mobile-result-grundsteuer">0 €</span>
                        </div>
                        <div class="breakdown-item">
                            <span data-de="Instandhaltung" data-en="Maintenance Reserve">Instandhaltung</span>
                            <span id="mobile-result-instandhaltung">0 €</span>
                        </div>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="mobile-results-actions">
                        <button class="mobile-action-button secondary" onclick="restartMobileQuiz()" data-de="Neu berechnen" data-en="Recalculate">Neu berechnen</button>
                        <button class="mobile-action-button primary" onclick="showMobileContact()" data-de="Beratung anfragen" data-en="Request Consultation">Beratung anfragen</button>
                    </div>
                </div>
            </div>
        </div>

        <main class="rechner-wrapper">
            <!-- Eingabe-Sektion -->
            <section class="input-section">
                <form id="cost-calculator-form">
                    
                    <div class="form-group">
                        <div class="label-wrapper">
                            <label for="kaufpreis" data-de="Kaufpreis der Immobilie (€)" data-en="Property Purchase Price (€)">Kaufpreis der Immobilie (€)</label>
                            <span id="kaufpreis-value" class="live-value">450.000 €</span>
                        </div>
                        <input type="range" id="kaufpreis" min="100000" max="2000000" step="5000" value="450000">
                    </div>

                    <div class="form-group">
                        <label for="wohnflaeche" data-de="Wohnfläche (m²)" data-en="Living Space (m²)">Wohnfläche (m²)</label>
                        <input type="number" id="wohnflaeche" value="120" placeholder="z.B. 120" data-placeholder-de="z.B. 120" data-placeholder-en="e.g. 120">
                        <p class="info-text" data-de="Wichtig für die Schätzung der Sanierungskosten." data-en="Important for estimating renovation costs.">Wichtig für die Schätzung der Sanierungskosten.</p>
                    </div>

                    <div class="form-group">
                        <div class="label-wrapper">
                            <label for="eigenkapital" data-de="Dein Eigenkapital (€)" data-en="Your Equity (€)">Dein Eigenkapital (€)</label>
                            <span id="eigenkapital-value" class="live-value">80.000 €</span>
                        </div>
                        <input type="range" id="eigenkapital" min="0" max="500000" step="1000" value="80000">
                    </div>

                    <div class="form-group">
                        <label for="bundesland" data-de="Bundesland" data-en="German State">Bundesland</label>
                        <select id="bundesland">
                            <!-- Options will be populated by JS -->
                        </select>
                        <p class="info-text" data-de="Die Grunderwerbsteuer ist je nach Bundesland unterschiedlich hoch." data-en="Property transfer tax varies by German state.">Die Grunderwerbsteuer ist je nach Bundesland unterschiedlich hoch.</p>
                    </div>

                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="mitMakler" checked>
                            <label for="mitMakler" data-de="Ja, mit Makler" data-en="Yes, with real estate agent">Ja, mit Makler</label>
                        </div>
                        <div id="makler-provision-rate-wrapper" class="makler-provision-rate visible">
                            <label for="maklerprovision" data-de="Provisionssatz inkl. MwSt. (%)" data-en="Commission rate incl. VAT (%)">Provisionssatz inkl. MwSt. (%)</label>
                            <input type="number" id="maklerprovision" value="3.57" step="0.01">
                        </div>
                    </div>

                    <div class="form-group">
                        <label data-de="Welche Sanierungen sind nötig?" data-en="Which renovations are needed?">Welche Sanierungen sind nötig?</label>
                        <p class="info-text" data-de="Sei ehrlich zu dir selbst. Das erspart dir böse Überraschungen." data-en="Be honest with yourself. This will save you from nasty surprises.">Sei ehrlich zu dir selbst. Das erspart dir böse Überraschungen.</p>
                        <div class="sanierung-checkboxes" id="sanierung-checkboxes">
                            <!-- Will be populated by JS -->
                        </div>
                    </div>
                    
                    <!-- Phase 2: Monatliche Belastung -->
                    <div class="phase-2" id="phase-2">
                        <h3 data-de="Schritt 2: Ihre monatliche Belastung" data-en="Step 2: Your Monthly Burden">Schritt 2: Ihre monatliche Belastung</h3>
                        
                        <div class="form-group">
                            <div class="label-wrapper">
                                <label for="zinssatz" data-de="Zinssatz (%)" data-en="Interest Rate (%)">Zinssatz (%)
                                    <span class="tooltip">
                                        <span class="info-icon">i</span>
                                        <span class="tooltip-text" data-de="Aktueller Marktzins. Ihre Bank wird Sie hier genau prüfen." data-en="Current market rate. Your bank will examine you closely here.">Aktueller Marktzins. Ihre Bank wird Sie hier genau prüfen.</span>
                                    </span>
                                </label>
                                <span id="zinssatz-value" class="live-value">3.8 %</span>
                            </div>
                            <input type="range" id="zinssatz" min="2.0" max="7.0" step="0.1" value="3.8">
                        </div>
                        
                        <div class="form-group">
                            <div class="label-wrapper">
                                <label for="tilgung" data-de="Anfängliche Tilgung (%)" data-en="Initial Repayment (%)">Anfängliche Tilgung (%)
                                    <span class="tooltip">
                                        <span class="info-icon">i</span>
                                        <span class="tooltip-text" data-de="Mindestens 2% sind heute Standard bei den meisten Banken. Je höher, desto schneller sind Sie schuldenfrei." data-en="At least 2% is standard at most banks today. The higher, the faster you'll be debt-free.">Mindestens 2% sind heute Standard bei den meisten Banken. Je höher, desto schneller sind Sie schuldenfrei.</span>
                                    </span>
                                </label>
                                <span id="tilgung-value" class="live-value">2.0 %</span>
                            </div>
                            <input type="range" id="tilgung" min="1.0" max="5.0" step="0.1" value="2.0">
                        </div>
                        
                        <div class="form-group">
                            <label for="hausgeld" data-de="Hausgeld / Nebenkosten (€/Monat)" data-en="Maintenance Fees / Utilities (€/Month)">Hausgeld / Nebenkosten (€/Monat)
                                <span class="tooltip">
                                    <span class="info-icon">i</span>
                                    <span class="tooltip-text" data-de="Fragen Sie den Makler nach dem Wirtschaftsplan! Rechnen Sie mit ca. 3,50 €/m² bei Wohnungen." data-en="Ask the agent for the management plan! Calculate about €3.50/m² for apartments.">Fragen Sie den Makler nach dem Wirtschaftsplan! Rechnen Sie mit ca. 3,50 €/m² bei Wohnungen.</span>
                                </span>
                            </label>
                            <input type="number" id="hausgeld" value="420" placeholder="z.B. 420" data-placeholder-de="z.B. 420" data-placeholder-en="e.g. 420">
                        </div>
                        
                        <div class="form-group">
                            <label for="grundsteuer" data-de="Grundsteuer (€/Jahr)" data-en="Property Tax (€/Year)">Grundsteuer (€/Jahr)
                                <span class="tooltip">
                                    <span class="info-icon">i</span>
                                    <span class="tooltip-text" data-de="Wird bald neu berechnet. Geben Sie hier den aktuellen Wert ein." data-en="Will be recalculated soon. Enter the current value here.">Wird bald neu berechnet. Geben Sie hier den aktuellen Wert ein.</span>
                                </span>
                            </label>
                            <input type="number" id="grundsteuer" value="800" placeholder="z.B. 800" data-placeholder-de="z.B. 800" data-placeholder-en="e.g. 800">
                        </div>
                    </div>

                </form>
            </section>

            <!-- Ergebnis-Sektion -->
            <section class="output-section">
                <div class="results-summary">
                    <h3 data-de="Ihre monatliche Gesamtbelastung" data-en="Your Total Monthly Burden">Ihre monatliche Gesamtbelastung</h3>
                    <div id="monthly-total-display" class="total-investment">0 € / Monat</div>
                    
                    <!-- Einkommen & Klartext-Urteil -->
                    <div class="einkommen-section">
                        <h3 data-de="Schritt 3: Das Klartext-Urteil" data-en="Step 3: The Truth Judgment">Schritt 3: Das Klartext-Urteil</h3>
                        
                        <div class="form-group">
                            <label for="nettoeinkommen" data-de="Dein monatliches Netto-Haushaltseinkommen (€)" data-en="Your monthly net household income (€)">Dein monatliches Netto-Haushaltseinkommen (€)</label>
                            <input type="number" id="nettoeinkommen" placeholder="z.B. 5200" data-placeholder-de="z.B. 5200" data-placeholder-en="e.g. 5200">
                            <p class="info-text" data-de="Alle Einkommen des Haushalts nach Abzug von Steuern und Sozialabgaben." data-en="All household income after deduction of taxes and social security contributions.">Alle Einkommen des Haushalts nach Abzug von Steuern und Sozialabgaben.</p>
                        </div>
                        
                        <div class="klartext-urteil" id="klartext-urteil">
                            <!-- Wird dynamisch befüllt -->
                        </div>
                        
                        <div class="dynamic-cta" id="dynamic-cta">
                            <!-- Wird dynamisch befüllt -->
                        </div>
                    </div>
                </div>

                <div class="chart-container">
                    <canvas id="cost-chart"></canvas>
                </div>

                <div class="cost-breakdown">
                    <ul>
                        <li><span class="cost-label" data-de="Monatliche Rate (Zins + Tilgung)" data-en="Monthly Rate (Interest + Repayment)">Monatliche Rate (Zins + Tilgung)</span> <span id="summary-monthly-rate" class="cost-value">0 € / Monat</span></li>
                        <li><span class="cost-label" data-de="Hausgeld / Nebenkosten" data-en="Maintenance Fees / Utilities">Hausgeld / Nebenkosten</span> <span id="summary-hausgeld" class="cost-value">0 € / Monat</span></li>
                        <li><span class="cost-label" data-de="Grundsteuer" data-en="Property Tax">Grundsteuer</span> <span id="summary-grundsteuer-monthly" class="cost-value">0 € / Monat</span></li>
                        <li><span class="cost-label" data-de="Instandhaltungsrücklage" data-en="Maintenance Reserve">Instandhaltungsrücklage
                            <span class="tooltip">
                                <span class="info-icon">i</span>
                                <span class="tooltip-text" data-de="Ihr persönlicher Spartopf für zukünftige Reparaturen (z.B. neue Heizung). Banken sehen gerne, dass Sie dies einplanen." data-en="Your personal savings pot for future repairs (e.g. new heating). Banks like to see that you plan for this.">Ihr persönlicher Spartopf für zukünftige Reparaturen (z.B. neue Heizung). Banken sehen gerne, dass Sie dies einplanen.</span>
                            </span>
                        </span> <span id="summary-instandhaltung" class="cost-value">0 € / Monat</span></li>
                        <hr class="divider">
                        <li class="total final-total"><span class="cost-label" data-de="IHRE MONATLICHE GESAMTBELASTUNG" data-en="YOUR TOTAL MONTHLY BURDEN">IHRE MONATLICHE GESAMTBELASTUNG</span> <span id="summary-monthly-total" class="cost-value">0 € / Monat</span></li>
                    </ul>
                </div>
                
                <!-- Zur Orientierung: Anschaffungskosten -->
                <div class="reference-costs">
                    <h4 data-de="Zur Orientierung: Kosten der Anschaffung" data-en="For Reference: Acquisition Costs">Zur Orientierung: Kosten der Anschaffung</h4>
                    <ul>
                        <li><span class="cost-label" data-de="Kaufpreis + Nebenkosten + Sanierung" data-en="Purchase price + Additional costs + Renovation">Kaufpreis + Nebenkosten + Sanierung</span> <span id="summary-base-costs" class="cost-value">0 €</span></li>
                        <li><span class="cost-label" data-de="Sicherheitsreserve (5%)" data-en="Safety reserve (5%)">Sicherheitsreserve (5%)
                            <span class="tooltip">
                                <span class="info-icon">i</span>
                                <span class="tooltip-text" data-de="Empfohlene Pufferreserve für unvorhergesehene Kosten bei der Anschaffung." data-en="Recommended buffer reserve for unforeseen costs during acquisition.">Empfohlene Pufferreserve für unvorhergesehene Kosten bei der Anschaffung.</span>
                            </span>
                        </span> <span id="summary-safety-buffer" class="cost-value">0 €</span></li>
                        <li><span class="cost-label" data-de="Gesamtkosten der Anschaffung" data-en="Total acquisition costs">Gesamtkosten der Anschaffung</span> <span id="summary-total-acquisition" class="cost-value">0 €</span></li>
                        <li><span class="cost-label" data-de="Daraus Finanzierungsbedarf" data-en="Resulting financing requirement">Daraus Finanzierungsbedarf</span> <span id="summary-finanzierungsbedarf" class="cost-value">0 €</span></li>
                    </ul>
                </div>
            </section>
        </main>
        
        <!-- Fallback CTA für Makler -->
        <footer class="cta-section" id="fallback-cta" style="display: none;">
            <div class="trust-section">
                <img src="fabian-kuypers.webp" alt="Fabian Valoa - Vertrauensfoto" class="trust-photo">
                <div class="calendar-cta">
                    <div class="calendar-text" data-de="Sie sind Makler?" data-en="Are you a real estate agent?">Sie sind Makler?</div>
                    <div class="calendar-subtext" data-de="Lassen Sie uns gemeinsam Ihre Makler-Tools optimieren" data-en="Let's optimize your real estate tools together">Lassen Sie uns gemeinsam Ihre Makler-Tools optimieren</div>
                    <a href="https://api.leadconnectorhq.com/widget/booking/kq7NmcLVgdbnxChd37gh" target="_blank" class="calendar-button" id="calendar-link-de-fallback" data-de="Kostenlose Beratung" data-en="Free Consultation">Kostenlose Beratung</a>
                    <a href="https://api.leadconnectorhq.com/widget/booking/lqxzeVwcGdummhsI026t" target="_blank" class="calendar-button" id="calendar-link-en-fallback" style="display: none;" data-de="Kostenlose Beratung" data-en="Free Consultation">Free Consultation</a>
                </div>
            </div>
            
            <div class="cta-buttons-section">
                <a href="https://valoa.studio" class="cta-button" data-de="Für Makler: So geht's" data-en="For Real Estate Agents: How it works">Für Makler: So geht's</a>
            </div>
        </footer>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        
        // --- DATENOBJEKTE ---
        const grunderwerbsteuerSaetze = {
            "Baden-Württemberg": 5.0, "Bayern": 3.5, "Berlin": 6.0, "Brandenburg": 6.5,
            "Bremen": 5.0, "Hamburg": 5.5, "Hessen": 6.0, "Mecklenburg-Vorpommern": 6.0,
            "Niedersachsen": 5.0, "Nordrhein-Westfalen": 6.5, "Rheinland-Pfalz": 5.0,
            "Saarland": 6.5, "Sachsen": 5.5, "Sachsen-Anhalt": 5.0, "Schleswig-Holstein": 6.5,
            "Thüringen": 5.0
        };

        const sanierungsOptionen = [
            { id: 'heizung', title: { de: 'Heizung erneuern (Pflicht nach GEG bei Kauf!)', en: 'Renew heating (mandatory per GEG when buying!)' }, cost: 25000 },
            { id: 'fenster', title: { de: 'Fenster (Doppelverglasung, alt)', en: 'Windows (double glazing, old)' }, cost: 15000 },
            { id: 'dach', title: { de: 'Dach dämmen', en: 'Insulate roof' }, cost: 20000 },
            { id: 'bad', title: { de: 'Bad sanieren (älter als 20 Jahre)', en: 'Renovate bathroom (older than 20 years)' }, cost: 12000 },
            { id: 'elektrik', title: { de: 'Elektrik erneuern (2-adrig)', en: 'Renew electrical (2-wire)' }, cost: 10000 },
            { id: 'maler', title: { de: 'Malerarbeiten & Böden', en: 'Painting & flooring' }, cost: 8000 }
        ];
        
        // Konstanten für Berechnungen
        const FAKTOR_INSTANDHALTUNG = 1; // €/m²/Monat
        const NOTARSATZ = 0.02; // 2%
        const SICHERHEITSPUFFER = 0.05; // 5%

        // --- DOM-ELEMENTE ---
        const form = document.getElementById('cost-calculator-form');
        const kaufpreisSlider = document.getElementById('kaufpreis');
        const kaufpreisValue = document.getElementById('kaufpreis-value');
        const wohnflaecheInput = document.getElementById('wohnflaeche');
        const eigenkapitalSlider = document.getElementById('eigenkapital');
        const eigenkapitalValue = document.getElementById('eigenkapital-value');
        const bundeslandSelect = document.getElementById('bundesland');
        const mitMaklerCheckbox = document.getElementById('mitMakler');
        const maklerProvisionRateWrapper = document.getElementById('makler-provision-rate-wrapper');
        const maklerProvisionInput = document.getElementById('maklerprovision');
        const sanierungCheckboxes = document.getElementById('sanierung-checkboxes');
        
        // Phase 2 Elemente
        const phase2 = document.getElementById('phase-2');
        const zinssatzSlider = document.getElementById('zinssatz');
        const zinssatzValue = document.getElementById('zinssatz-value');
        const tilgungSlider = document.getElementById('tilgung');
        const tilgungValue = document.getElementById('tilgung-value');
        const hausgeldInput = document.getElementById('hausgeld');
        const grundsteuerInput = document.getElementById('grundsteuer');
        
        // Phase 3 Elemente (Klartext-Urteil)
        const nettoeinkommenInput = document.getElementById('nettoeinkommen');
        const klartextUrteilDiv = document.getElementById('klartext-urteil');
        const dynamicCtaDiv = document.getElementById('dynamic-cta');
        const fallbackCta = document.getElementById('fallback-cta');
        
        // Output-Elemente
        const monthlyTotalDisplay = document.getElementById('monthly-total-display');
        const summaryMonthlyRate = document.getElementById('summary-monthly-rate');
        const summaryHausgeld = document.getElementById('summary-hausgeld');
        const summaryGrundsteuerMonthly = document.getElementById('summary-grundsteuer-monthly');
        const summaryInstandhaltung = document.getElementById('summary-instandhaltung');
        const summaryMonthlyTotal = document.getElementById('summary-monthly-total');
        const summaryBaseCosts = document.getElementById('summary-base-costs');
        const summarySafetyBuffer = document.getElementById('summary-safety-buffer');
        const summaryTotalAcquisition = document.getElementById('summary-total-acquisition');
        const summaryFinanzierungsbedarf = document.getElementById('summary-finanzierungsbedarf');
        
        // Chart
        const ctx = document.getElementById('cost-chart').getContext('2d');
        let costChart;

        // --- INITIALISIERUNG ---
        function init() {
            // Dropdowns befüllen
            populateDropdown(bundeslandSelect, Object.keys(grunderwerbsteuerSaetze), 'Nordrhein-Westfalen');
            populateSanierungCheckboxes();

            // Event Listeners hinzufügen
            form.addEventListener('input', calculateAndDisplay);
            form.addEventListener('change', calculateAndDisplay);
            mitMaklerCheckbox.addEventListener('change', toggleMaklerProvision);
            
            // Live-Slider Updates
            kaufpreisSlider.addEventListener('input', updateKaufpreisDisplay);
            eigenkapitalSlider.addEventListener('input', updateEigenkapitalDisplay);
            zinssatzSlider.addEventListener('input', updateZinssatzDisplay);
            tilgungSlider.addEventListener('input', updateTilgungDisplay);
            
            // Einkommen-Input für Klartext-Urteil
            nettoeinkommenInput.addEventListener('input', calculateBelastungsquote);

            // Chart initialisieren
            initializeChart();
            
            // Erste Berechnung durchführen
            calculateAndDisplay();
        }

        function populateDropdown(selectElement, options, defaultValue) {
            options.forEach(option => {
                const optionElement = document.createElement('option');
                optionElement.value = option;
                optionElement.textContent = option;
                if (option === defaultValue) {
                    optionElement.selected = true;
                }
                selectElement.appendChild(optionElement);
            });
        }
        
        function populateSanierungCheckboxes() {
            sanierungsOptionen.forEach(option => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'sanierung-item';
                
                itemDiv.innerHTML = `
                    <input type="checkbox" id="sanierung-${option.id}" name="sanierung" value="${option.id}">
                    <div class="sanierung-details">
                        <div class="sanierung-title" data-de="${option.title.de}" data-en="${option.title.en}">${option.title.de}</div>
                        <div class="sanierung-cost">+ ${formatCurrency(option.cost)}</div>
                    </div>
                `;
                
                // Add click event listener to the entire item
                itemDiv.addEventListener('click', function(e) {
                    // Don't trigger if the checkbox itself was clicked
                    if (e.target.type === 'checkbox') return;
                    
                    const checkbox = itemDiv.querySelector('input[type="checkbox"]');
                    checkbox.checked = !checkbox.checked;
                    
                    // Update visual state
                    updateSanierungItemState(itemDiv, checkbox.checked);
                    
                    // Trigger calculation update
                    calculateAndDisplay();
                });
                
                // Add change event listener to checkbox for direct checkbox clicks
                const checkbox = itemDiv.querySelector('input[type="checkbox"]');
                checkbox.addEventListener('change', function() {
                    updateSanierungItemState(itemDiv, this.checked);
                });
                
                sanierungCheckboxes.appendChild(itemDiv);
            });
        }
        
        function updateSanierungItemState(itemDiv, isChecked) {
            if (isChecked) {
                itemDiv.classList.add('selected');
            } else {
                itemDiv.classList.remove('selected');
            }
        }
        
        function updateKaufpreisDisplay() {
            kaufpreisValue.textContent = formatCurrency(parseFloat(kaufpreisSlider.value));
            checkPhase2Visibility();
        }
        
        function updateEigenkapitalDisplay() {
            eigenkapitalValue.textContent = formatCurrency(parseFloat(eigenkapitalSlider.value));
        }
        
        function updateZinssatzDisplay() {
            zinssatzValue.textContent = parseFloat(zinssatzSlider.value).toFixed(1) + ' %';
        }
        
        function updateTilgungDisplay() {
            tilgungValue.textContent = parseFloat(tilgungSlider.value).toFixed(1) + ' %';
        }
        
        function checkPhase2Visibility() {
            const kaufpreis = parseFloat(kaufpreisSlider.value);
            const wohnflaeche = parseFloat(wohnflaecheInput.value) || 0;
            
            if (kaufpreis > 0 && wohnflaeche > 0) {
                phase2.classList.add('visible');
            } else {
                phase2.classList.remove('visible');
            }
        }
        
        function toggleMaklerProvision() {
            maklerProvisionRateWrapper.classList.toggle('visible', mitMaklerCheckbox.checked);
            calculateAndDisplay();
        }

        // --- BERECHNUNGSLOGIK ---
        function calculateAndDisplay() {
            // 1. Werte aus dem Formular lesen
            const kaufpreis = parseFloat(kaufpreisSlider.value);
            const wohnflaeche = parseFloat(wohnflaecheInput.value) || 0;
            const eigenkapital = parseFloat(eigenkapitalSlider.value);
            const bundesland = bundeslandSelect.value;
            const istMitMakler = mitMaklerCheckbox.checked;
            const maklerSatz = parseFloat(maklerProvisionInput.value) / 100 || 0;
            
            // Phase 2 Werte
            const zinssatz = parseFloat(zinssatzSlider.value) / 100;
            const tilgung = parseFloat(tilgungSlider.value) / 100;
            const hausgeld = parseFloat(hausgeldInput.value) || 0;
            const grundsteuerJahr = parseFloat(grundsteuerInput.value) || 0;

            // 2. Anschaffungskosten berechnen
            const notarKosten = kaufpreis * NOTARSATZ;
            const steuerSatz = grunderwerbsteuerSaetze[bundesland] / 100;
            const grunderwerbsteuer = kaufpreis * steuerSatz;
            const maklerKosten = istMitMakler ? kaufpreis * maklerSatz : 0;
            const nebenkosten = notarKosten + grunderwerbsteuer + maklerKosten;

            // Sanierungskosten aus Checkboxen
            const sanierungskosten = calculateSanierungskosten();

            const zwischensumme = kaufpreis + nebenkosten + sanierungskosten;
            const sicherheitspuffer = zwischensumme * SICHERHEITSPUFFER;
            
            const gesamtInvestition = zwischensumme + sicherheitspuffer;
            const finanzierungsbedarf = Math.max(0, gesamtInvestition - eigenkapital);

            // 3. Monatliche Kosten berechnen
            const monatlicheRate = calculateMonthlyRate(finanzierungsbedarf, zinssatz, tilgung);
            const grundsteuerMonatlich = grundsteuerJahr / 12;
            const instandhaltung = wohnflaeche * FAKTOR_INSTANDHALTUNG;
            const monatlicheGesamtbelastung = monatlicheRate + hausgeld + grundsteuerMonatlich + instandhaltung;

            // 4. Ergebnisse anzeigen
            updateKaufpreisDisplay();
            updateEigenkapitalDisplay();
            updateZinssatzDisplay();
            updateTilgungDisplay();
            checkPhase2Visibility();

            // Haupt-Ergebnisse
            monthlyTotalDisplay.textContent = formatCurrency(monatlicheGesamtbelastung) + ' / Monat';

            // Detail-Aufschlüsselung
            summaryMonthlyRate.textContent = formatCurrency(monatlicheRate) + ' / Monat';
            summaryHausgeld.textContent = formatCurrency(hausgeld) + ' / Monat';
            summaryGrundsteuerMonthly.textContent = formatCurrency(grundsteuerMonatlich) + ' / Monat';
            summaryInstandhaltung.textContent = formatCurrency(instandhaltung) + ' / Monat';
            summaryMonthlyTotal.textContent = formatCurrency(monatlicheGesamtbelastung) + ' / Monat';
            summaryBaseCosts.textContent = formatCurrency(zwischensumme);
            summarySafetyBuffer.textContent = formatCurrency(sicherheitspuffer);
            summaryTotalAcquisition.textContent = formatCurrency(gesamtInvestition);
            summaryFinanzierungsbedarf.textContent = formatCurrency(finanzierungsbedarf);
            
            // Hinweis: Warnhinweis wurde in das Klartext-Urteil integriert
            
            // 5. Chart aktualisieren
            updateChart([monatlicheRate, hausgeld, grundsteuerMonatlich, instandhaltung]);
            
            // 6. Prüfe, ob Belastungsquote berechnet werden kann
            if (nettoeinkommenInput.value > 0) {
                calculateBelastungsquote();
            }
        }
        
        function calculateSanierungskosten() {
            let total = 0;
            const checkboxes = document.querySelectorAll('input[name="sanierung"]:checked');
            
            checkboxes.forEach(checkbox => {
                const option = sanierungsOptionen.find(opt => opt.id === checkbox.value);
                if (option) {
                    total += option.cost;
                }
            });
            
            return total;
        }
        
        function calculateMonthlyRate(darlehensbetrag, zinssatz, tilgung) {
            if (darlehensbetrag <= 0) return 0;
            const monatlicheRate = darlehensbetrag * (zinssatz + tilgung) / 12;
            return monatlicheRate;
        }
        
        // --- KLARTEXT-URTEIL FUNKTIONEN ---
        function calculateBelastungsquote() {
            const nettoeinkommen = parseFloat(nettoeinkommenInput.value) || 0;
            
            if (nettoeinkommen <= 0) {
                klartextUrteilDiv.classList.remove('visible');
                dynamicCtaDiv.classList.remove('visible');
                fallbackCta.style.display = 'block';
                return;
            }
            
            // Hole die aktuelle monatliche Gesamtbelastung
            const monatlicheGesamtbelastung = getCurrentMonthlyBurden();
            
            if (monatlicheGesamtbelastung <= 0) {
                return; // Warte bis alle anderen Werte berechnet sind
            }
            
            const belastungsquote = (monatlicheGesamtbelastung / nettoeinkommen) * 100;
            
            // Urteil anzeigen
            showKlartextUrteil(belastungsquote);
            
            // Passenden CTA anzeigen
            showDynamicCta(belastungsquote);
            
            // Fallback CTA verstecken
            fallbackCta.style.display = 'none';
        }
        
        function getCurrentMonthlyBurden() {
            // Hole die aktuellen Werte aus dem Formular
            const kaufpreis = parseFloat(kaufpreisSlider.value);
            const wohnflaeche = parseFloat(wohnflaecheInput.value) || 0;
            const eigenkapital = parseFloat(eigenkapitalSlider.value);
            const bundesland = bundeslandSelect.value;
            const istMitMakler = mitMaklerCheckbox.checked;
            const maklerSatz = parseFloat(maklerProvisionInput.value) / 100 || 0;
            const zinssatz = parseFloat(zinssatzSlider.value) / 100;
            const tilgung = parseFloat(tilgungSlider.value) / 100;
            const hausgeld = parseFloat(hausgeldInput.value) || 0;
            const grundsteuerJahr = parseFloat(grundsteuerInput.value) || 0;

            // Berechne Anschaffungskosten
            const notarKosten = kaufpreis * NOTARSATZ;
            const steuerSatz = grunderwerbsteuerSaetze[bundesland] / 100;
            const grunderwerbsteuer = kaufpreis * steuerSatz;
            const maklerKosten = istMitMakler ? kaufpreis * maklerSatz : 0;
            const nebenkosten = notarKosten + grunderwerbsteuer + maklerKosten;
            const sanierungskosten = calculateSanierungskosten();
            const zwischensumme = kaufpreis + nebenkosten + sanierungskosten;
            const sicherheitspuffer = zwischensumme * SICHERHEITSPUFFER;
            const gesamtInvestition = zwischensumme + sicherheitspuffer;
            const finanzierungsbedarf = Math.max(0, gesamtInvestition - eigenkapital);

            // Berechne monatliche Kosten
            const monatlicheRate = calculateMonthlyRate(finanzierungsbedarf, zinssatz, tilgung);
            const grundsteuerMonatlich = grundsteuerJahr / 12;
            const instandhaltung = wohnflaeche * FAKTOR_INSTANDHALTUNG;
            
            return monatlicheRate + hausgeld + grundsteuerMonatlich + instandhaltung;
        }
        
        function showKlartextUrteil(belastungsquote) {
            let urteilClass, icon, text, beschreibung, zusatzInfo;
            
            if (belastungsquote < 38) {
                // Grüner Bereich
                urteilClass = 'urteil-gruen';
                icon = '✅';
                text = currentLanguage === 'de' ? 'Grüner Bereich' : 'Green Zone';
                beschreibung = currentLanguage === 'de' 
                    ? 'Das sieht solide aus. Banken bewerten eine solche Quote in der Regel positiv.'
                    : 'This looks solid. Banks usually rate such a quota positively.';
                zusatzInfo = '';
            } else if (belastungsquote <= 45) {
                // Gelber Bereich
                urteilClass = 'urteil-gelb';
                icon = '⚠️';
                text = currentLanguage === 'de' ? 'Sportlich' : 'Challenging';
                beschreibung = currentLanguage === 'de'
                    ? 'Das ist machbar, aber die Bank wird sehr genau auf Ihre weiteren Ausgaben und Sicherheiten schauen.'
                    : 'This is feasible, but the bank will look very closely at your other expenses and securities.';
                zusatzInfo = '';
            } else {
                // Roter Bereich
                urteilClass = 'urteil-rot';
                icon = '🛑';
                text = currentLanguage === 'de' ? 'Kritisch' : 'Critical';
                beschreibung = currentLanguage === 'de'
                    ? 'Seien Sie ehrlich: Das ist für die meisten Haushalte nicht tragbar und wird von Banken nur in Ausnahmefällen finanziert.'
                    : 'Be honest: This is not sustainable for most households and is only financed by banks in exceptional cases.';
                zusatzInfo = currentLanguage === 'de'
                    ? 'Hinweis: Hohes Eigenkapital oder zusätzliche Sicherheiten können eine kritische Quote in manchen Fällen ausgleichen. Dies wird individuell von der Bank geprüft.'
                    : 'Note: High equity or additional securities can sometimes compensate for a critical ratio. This is checked individually by the bank.';
            }
            
            klartextUrteilDiv.className = `klartext-urteil visible ${urteilClass}`;
            klartextUrteilDiv.innerHTML = `
                <div class="urteil-icon">${icon}</div>
                <div class="belastungsquote">${belastungsquote.toFixed(1)}%</div>
                <div class="urteil-text">${text}</div>
                <div class="urteil-beschreibung">${beschreibung}</div>
                ${zusatzInfo ? `<div class="zusatz-info">${zusatzInfo}</div>` : ''}
            `;
        }
        
        function showDynamicCta(belastungsquote) {
            let ctaClass, uberschrift, text, buttonText;
            
            if (belastungsquote < 38) {
                // CTA für solvente Käufer
                ctaClass = 'cta-gruen';
                uberschrift = currentLanguage === 'de' ? 'Glückwunsch! Sie sind kaufbereit.' : 'Congratulations! You are ready to buy.';
                text = currentLanguage === 'de'
                    ? 'Ihr Ergebnis zeigt: Sie gehören zu den wenigen Interessenten, die ihre Hausaufgaben gemacht haben. Verschwenden Sie keine Zeit mit Maklern, die das nicht zu schätzen wissen.'
                    : 'Your result shows: You are one of the few prospects who have done their homework. Don\'t waste time with agents who don\'t appreciate that.';
                buttonText = currentLanguage === 'de' ? 'Kontakt anfordern' : 'Request Contact';
            } else {
                // CTA für unsichere Käufer
                ctaClass = 'cta-gelb-rot';
                uberschrift = currentLanguage === 'de' ? 'Das Ergebnis ist ernüchternd? Gut.' : 'The result is sobering? Good.';
                text = currentLanguage === 'de'
                    ? 'Genau das ist der Sinn dieses Rechners: Ehrlichkeit, bevor Zeit und Geld verbrannt werden. Ein Top-Makler verkauft Ihnen keine Träume, sondern findet realistische Lösungen.'
                    : 'That\'s exactly the point of this calculator: honesty before time and money are wasted. A top agent doesn\'t sell you dreams, but finds realistic solutions.';
                buttonText = currentLanguage === 'de' ? 'Kostenlose Erstberatung' : 'Free Initial Consultation';
            }
            
            dynamicCtaDiv.className = `dynamic-cta visible ${ctaClass}`;
            dynamicCtaDiv.innerHTML = `
                <h2>${uberschrift}</h2>
                <p>${text}</p>
                <form action="#" class="form-inline" onsubmit="handleCtaSubmit(event, '${belastungsquote < 38 ? 'solvent' : 'unsicher'}')">
                    <input type="email" name="email" placeholder="${currentLanguage === 'de' ? 'Ihre E-Mail-Adresse' : 'Your email address'}" required>
                    <button type="submit">${buttonText}</button>
                </form>
            `;
        }
        
        // Form-Handler für CTA
        function handleCtaSubmit(event, userType) {
            event.preventDefault();
            const email = event.target.email.value;
            
            // Hier könntest du die E-Mail an dein Backend senden
            console.log('CTA Submit:', { email, userType, timestamp: new Date() });
            
            // Feedback für den Nutzer
            const button = event.target.querySelector('button');
            const originalText = button.textContent;
            button.textContent = currentLanguage === 'de' ? 'Vielen Dank!' : 'Thank you!';
            button.disabled = true;
            
            setTimeout(() => {
                button.textContent = originalText;
                button.disabled = false;
                event.target.email.value = '';
            }, 3000);
        }
        
        // --- CHART FUNKTIONEN ---
        function getCssVar(name) {
            return getComputedStyle(document.documentElement).getPropertyValue(name).trim();
        }

        function initializeChart() {
            costChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Finanzierung', 'Hausgeld/Nebenkosten', 'Grundsteuer', 'Instandhaltungsrücklage'],
                    datasets: [{
                        data: [0, 0, 0, 0],
                        backgroundColor: [
                            getCssVar('--chart-primary'),
                            getCssVar('--chart-primary-light'),
                            getCssVar('--chart-warning'),
                            getCssVar('--chart-warning-light')
                        ],
                        borderColor: '#FFFFFF',
                        borderWidth: 4,
                        hoverOffset: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '65%',
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                font: {
                                    family: getCssVar('--font-family') || "'Inter', sans-serif"
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed !== null) {
                                        label += formatCurrency(context.parsed) + ' / Monat';
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        function updateChart(data) {
            costChart.data.datasets[0].data = data;
            costChart.update();
        }

        // --- HELPER FUNKTIONEN ---
        function formatCurrency(value) {
            return new Intl.NumberFormat('de-DE', { style: 'currency', currency: 'EUR', minimumFractionDigits: 0 }).format(value);
        }

        // --- Start ---
        init();
    });
    
    // --- LANGUAGE TOGGLE FUNCTIONALITY ---
    let currentLanguage = 'de';
    
    function switchLanguage(lang) {
        currentLanguage = lang;
        
        // Update button states
        document.getElementById('lang-de').classList.toggle('active', lang === 'de');
        document.getElementById('lang-en').classList.toggle('active', lang === 'en');
        
        // Update calendar links visibility
        const calendarDe = document.getElementById('calendar-link-de');
        const calendarEn = document.getElementById('calendar-link-en');
        const calendarDeFallback = document.getElementById('calendar-link-de-fallback');
        const calendarEnFallback = document.getElementById('calendar-link-en-fallback');
        
        if (calendarDe) calendarDe.style.display = lang === 'de' ? 'block' : 'none';
        if (calendarEn) calendarEn.style.display = lang === 'en' ? 'block' : 'none';
        if (calendarDeFallback) calendarDeFallback.style.display = lang === 'de' ? 'block' : 'none';
        if (calendarEnFallback) calendarEnFallback.style.display = lang === 'en' ? 'block' : 'none';
        
        // Update all elements with data-de and data-en attributes
        const elements = document.querySelectorAll('[data-de][data-en]');
        elements.forEach(element => {
            const text = element.getAttribute(`data-${lang}`);
            if (text) {
                element.textContent = text;
            }
        });
        
        // Update placeholders
        const placeholderElements = document.querySelectorAll(`[data-placeholder-${lang}]`);
        placeholderElements.forEach(element => {
            const placeholder = element.getAttribute(`data-placeholder-${lang}`);
            if (placeholder) {
                element.placeholder = placeholder;
            }
        });
        
        // Update chart labels based on language
        updateChartLanguage(lang);
        
        // Re-calculate Klartext-Urteil if visible to update language
        if (klartextUrteilDiv.classList.contains('visible')) {
            calculateBelastungsquote();
        }
        
        // Update mobile step navigation language
        updateMobileStepLanguage(lang);
        
        // Update calendar popup language
        updateCalendarLanguage();
    }
    
    function updateChartLanguage(lang) {
        if (typeof costChart !== 'undefined' && costChart) {
            const labels = lang === 'de' 
                ? ['Finanzierung', 'Hausgeld/Nebenkosten', 'Grundsteuer', 'Instandhaltungsrücklage']
                : ['Financing', 'Maintenance Fees/Utilities', 'Property Tax', 'Maintenance Reserve'];
            
            costChart.data.labels = labels;
            costChart.update();
        }
    }
    
    // --- MOBILE STEP NAVIGATION ---
    let currentStep = 0;
    const mobileSteps = [
        {
            title: { de: 'Schritt 1: Kaufpreis', en: 'Step 1: Purchase Price' },
            fields: ['kaufpreis']
        },
        {
            title: { de: 'Schritt 2: Wohnfläche', en: 'Step 2: Living Space' },
            fields: ['wohnflaeche']
        },
        {
            title: { de: 'Schritt 3: Eigenkapital', en: 'Step 3: Equity' },
            fields: ['eigenkapital']
        },
        {
            title: { de: 'Schritt 4: Bundesland', en: 'Step 4: German State' },
            fields: ['bundesland']
        },
        {
            title: { de: 'Schritt 5: Makler', en: 'Step 5: Real Estate Agent' },
            fields: ['mitMakler']
        },
        {
            title: { de: 'Schritt 6: Sanierungen', en: 'Step 6: Renovations' },
            fields: ['sanierung-checkboxes']
        },
        {
            title: { de: 'Schritt 7: Zinssatz', en: 'Step 7: Interest Rate' },
            fields: ['zinssatz']
        },
        {
            title: { de: 'Schritt 8: Tilgung', en: 'Step 8: Repayment' },
            fields: ['tilgung']
        },
        {
            title: { de: 'Schritt 9: Hausgeld', en: 'Step 9: Maintenance Fees' },
            fields: ['hausgeld']
        },
        {
            title: { de: 'Schritt 10: Grundsteuer', en: 'Step 10: Property Tax' },
            fields: ['grundsteuer']
        },
        {
            title: { de: 'Schritt 11: Ihr Einkommen', en: 'Step 11: Your Income' },
            fields: ['nettoeinkommen']
        }
    ];
    
    function startMobileSteps() {
        console.log('🚀 startMobileSteps() called');
        
        // Ensure DOM is fully ready and form elements are loaded
        function waitForFormElements() {
            const kaufpreisElement = document.getElementById('kaufpreis');
            console.log('🔍 Checking for kaufpreis element:', kaufpreisElement);
            
            if (kaufpreisElement) {
                console.log('✅ Form elements ready, starting quiz');
                currentStep = 0;
                const navigation = document.getElementById('mobile-step-navigation');
                console.log('📱 Navigation element:', navigation);
                navigation.classList.add('active');
                console.log('✅ Added active class to navigation');
                
                console.log('📋 Calling showMobileStep(0)');
                showMobileStep(currentStep);
            } else {
                console.log('⏳ Form elements not ready yet, waiting...');
                setTimeout(waitForFormElements, 50);
            }
        }
        
        waitForFormElements();
    }
    
    function closeMobileSteps() {
        const navigation = document.getElementById('mobile-step-navigation');
        navigation.classList.remove('active');
    }
    
    function nextStep() {
        console.log(`🚀 nextStep() called, currentStep: ${currentStep}, maxSteps: ${mobileSteps.length}`);
        
        // Validierung für Schritt 11 (Nettoeinkommen)
        if (currentStep === 10) {
            console.log('💰 Validating Nettoeinkommen (step 11)...');
            const nettoeinkommenInput = document.getElementById('mobile-nettoeinkommen') || document.getElementById('nettoeinkommen');
            console.log('📊 Nettoeinkommen input element:', nettoeinkommenInput);
            const nettoeinkommen = parseFloat(nettoeinkommenInput?.value) || 0;
            console.log('💵 Nettoeinkommen value:', nettoeinkommen);
            
            if (nettoeinkommen <= 0) {
                console.log('❌ Validation failed - no income entered');
                // Fehlermeldung anzeigen
                showMobileValidationError(currentLanguage === 'de' 
                    ? 'Bitte geben Sie Ihr monatliches Nettoeinkommen ein, um das Ergebnis zu sehen.'
                    : 'Please enter your monthly net income to see the result.');
                return;
            } else {
                console.log('✅ Validation passed - income is valid');
                // Fehlermeldung verstecken falls sichtbar
                hideMobileValidationError();
            }
        }
        
        if (currentStep < mobileSteps.length - 1) {
            console.log(`➡️ Moving to next step: ${currentStep + 1}`);
            currentStep++;
            showMobileStep(currentStep);
        } else {
            console.log('🏁 Reached final step - showing results');
            console.log('🚪 Closing mobile steps...');
            closeMobileSteps();
            console.log('📊 Scrolling to results...');
            scrollToResults();
        }
    }
    
    function previousStep() {
        if (currentStep > 0) {
            currentStep--;
            showMobileStep(currentStep);
        }
    }
    
    function showMobileStep(stepIndex) {
        console.log(`🔥 showMobileStep(${stepIndex}) called`);
        
        const step = mobileSteps[stepIndex];
        console.log('📝 Current step data:', step);
        
        const stepTitle = document.getElementById('step-title');
        const stepContent = document.getElementById('step-content');
        const prevButton = document.getElementById('prev-button');
        const nextButton = document.getElementById('next-button');
        
        console.log('🎯 DOM elements:', {
            stepTitle,
            stepContent,
            prevButton,
            nextButton
        });
        
        // Update title
        const titleText = step.title[currentLanguage || 'de'];
        console.log(`📰 Setting title to: "${titleText}" (language: ${currentLanguage || 'de'})`);
        stepTitle.textContent = titleText;
        
        // Clear content
        console.log('🗑️ Clearing step content');
        stepContent.innerHTML = '';
        
        // Wait a moment to ensure DOM is fully loaded
        setTimeout(() => {
            console.log('⏰ Fields processing timeout started');
            console.log(`🔍 Processing ${step.fields.length} fields:`, step.fields);
            
            // Add fields for this step
            step.fields.forEach((fieldId, index) => {
                console.log(`\n🔎 [${index + 1}/${step.fields.length}] Processing field: "${fieldId}"`);
                
                let originalElement = document.getElementById(fieldId);
                console.log(`📍 Original element by ID "${fieldId}":`, originalElement);
                
                let fieldGroup;
                
                // Special handling for different field types
                if (fieldId === 'sanierung-checkboxes') {
                    fieldGroup = document.getElementById('sanierung-checkboxes');
                    console.log('🏗️ Sanierung checkboxes field group:', fieldGroup);
                } else if (fieldId === 'mitMakler') {
                    // For makler, get the form-group that contains both checkbox and provision rate
                    originalElement = document.getElementById('mitMakler');
                    if (originalElement) {
                        // The form-group already contains both the checkbox and the provision rate wrapper
                        fieldGroup = originalElement.closest('.form-group');
                    }
                    console.log('🏢 Makler field group (complete):', fieldGroup);
                } else {
                    if (!originalElement) {
                        console.log(`🔍 Element "${fieldId}" not found, trying wildcard search...`);
                        originalElement = document.querySelector(`[id*="${fieldId}"]`);
                        console.log('🔍 Wildcard search result:', originalElement);
                    }
                    if (originalElement) {
                        fieldGroup = originalElement.closest('.form-group');
                        console.log('📦 Found form group:', fieldGroup);
                    } else {
                        console.log('❌ No original element found for:', fieldId);
                    }
                }
                
                if (fieldGroup) {
                    console.log('✅ Cloning field group...');
                    const clone = fieldGroup.cloneNode(true);
                    
                    console.log('🏷️ Updating IDs...');
                    updateClonedIds(clone, 'mobile-');
                    
                    console.log('🔗 Adding event listeners...');
                    addMobileEventListeners(clone, fieldId);
                    
                    console.log('🔄 Syncing live values...');
                    syncInitialLiveValues(clone);
                    
                    console.log('📱 Adding mobile tooltip functionality...');
                    addMobileTooltipListeners(clone);
                    
                    console.log('➕ Appending to step content...');
                    stepContent.appendChild(clone);
                    
                    console.log(`✅ Successfully added field "${fieldId}" to step content`);
                } else {
                    console.error(`❌ No field group found for: "${fieldId}"`);
                    console.log('🔍 Available form groups:', document.querySelectorAll('.form-group'));
                }
            });
            
            console.log('✨ Finished processing all fields');
            console.log('📄 Final step content HTML length:', stepContent.innerHTML.length);
            console.log('👀 Step content children count:', stepContent.children.length);
        }, 50);
        
        // Update navigation buttons
        prevButton.style.display = stepIndex === 0 ? 'none' : 'block';
        nextButton.textContent = stepIndex === mobileSteps.length - 1 
            ? (currentLanguage === 'de' ? 'Ergebnis ansehen' : 'View Results')
            : (currentLanguage === 'de' ? 'Weiter' : 'Next');
            
        // Also update button language attributes
        const currentLang = currentLanguage || 'de';
        prevButton.textContent = currentLang === 'de' ? 'Zurück' : 'Back';
        nextButton.textContent = stepIndex === mobileSteps.length - 1 
            ? (currentLang === 'de' ? 'Ergebnis ansehen' : 'View Results')
            : (currentLang === 'de' ? 'Weiter' : 'Next');
    }
    
    function updateClonedIds(element, prefix) {
        if (element.id) {
            element.id = prefix + element.id;
        }
        
        // Update for attribute of labels
        const labels = element.querySelectorAll('label[for]');
        labels.forEach(label => {
            if (label.getAttribute('for')) {
                label.setAttribute('for', prefix + label.getAttribute('for'));
            }
        });
        
        // Update IDs of input elements
        const inputs = element.querySelectorAll('[id]');
        inputs.forEach(input => {
            if (input.id) {
                input.id = prefix + input.id;
            }
        });
    }
    
    function addMobileEventListeners(clone, originalFieldId) {
        const inputs = clone.querySelectorAll('input, select');
        inputs.forEach(input => {
            const originalId = input.id.replace('mobile-', '');
            const originalInput = document.getElementById(originalId);
            
            if (originalInput) {
                // Sync value from original
                if (input.type === 'checkbox') {
                    input.checked = originalInput.checked;
                } else {
                    input.value = originalInput.value;
                }
                
                // Add event listener to sync back
                input.addEventListener('input', function() {
                    if (originalInput.type === 'checkbox') {
                        originalInput.checked = this.checked;
                    } else {
                        originalInput.value = this.value;
                    }
                    
                    // Trigger original calculation
                    originalInput.dispatchEvent(new Event('input', { bubbles: true }));
                    
                    // Update live value display if it exists
                    const liveValueElement = clone.querySelector(`#mobile-${originalId}-value`);
                    const originalLiveValue = document.getElementById(`${originalId}-value`);
                    if (liveValueElement && originalLiveValue) {
                        liveValueElement.textContent = originalLiveValue.textContent;
                    }
                    
                    // Validierung für Nettoeinkommen
                    if (originalId === 'nettoeinkommen' && currentStep === 10) {
                        const nettoeinkommen = parseFloat(this.value) || 0;
                        if (nettoeinkommen > 0) {
                            hideMobileValidationError();
                        }
                    }
                });
                
                input.addEventListener('change', function() {
                    if (originalInput.type === 'checkbox') {
                        originalInput.checked = this.checked;
                    } else {
                        originalInput.value = this.value;
                    }
                    
                    // Trigger original calculation
                    originalInput.dispatchEvent(new Event('change', { bubbles: true }));
                });
            }
        });
        
        // Handle sanierung checkboxes specially
        if (originalFieldId.includes('sanierung')) {
            const sanierungItems = clone.querySelectorAll('.sanierung-item');
            sanierungItems.forEach(item => {
                const checkbox = item.querySelector('input[type="checkbox"]');
                if (checkbox) {
                    const originalCheckbox = document.getElementById(checkbox.id.replace('mobile-', ''));
                    if (originalCheckbox) {
                        checkbox.checked = originalCheckbox.checked;
                        
                        item.addEventListener('click', function(e) {
                            if (e.target.type === 'checkbox') return;
                            checkbox.checked = !checkbox.checked;
                            originalCheckbox.checked = checkbox.checked;
                            originalCheckbox.dispatchEvent(new Event('change', { bubbles: true }));
                        });
                        
                        checkbox.addEventListener('change', function() {
                            originalCheckbox.checked = this.checked;
                            originalCheckbox.dispatchEvent(new Event('change', { bubbles: true }));
                        });
                    }
                }
            });
        }
    }
    
    function scrollToResults() {
        console.log('📊 scrollToResults() called - showing mobile results page');
        showMobileResults();
    }
    
    function showMobileResults() {
        // Calculate current values
        const results = calculateCurrentResults();
        
        // Update mobile results page
        updateMobileResults(results);
        
        // Show mobile results page
        const mobileResults = document.getElementById('mobile-results-page');
        mobileResults.classList.add('active');
    }
    
    function calculateCurrentResults() {
        // Get current form values (similar to calculateAndDisplay but return values)
        const kaufpreis = parseFloat(document.getElementById('kaufpreis').value) || 0;
        const wohnflaeche = parseFloat(document.getElementById('wohnflaeche').value) || 0;
        const eigenkapital = parseFloat(document.getElementById('eigenkapital').value) || 0;
        const nettoeinkommen = parseFloat(document.getElementById('nettoeinkommen').value) || 0;
        const zinssatz = parseFloat(document.getElementById('zinssatz').value) / 100 || 0;
        const tilgung = parseFloat(document.getElementById('tilgung').value) / 100 || 0;
        const hausgeld = parseFloat(document.getElementById('hausgeld').value) || 0;
        const grundsteuerJahr = parseFloat(document.getElementById('grundsteuer').value) || 0;
        
        // Calculate monthly costs
        const finanzierungsbedarf = Math.max(0, kaufpreis - eigenkapital); // Simplified
        const monatlicheRate = finanzierungsbedarf * (zinssatz + tilgung) / 12;
        const grundsteuerMonatlich = grundsteuerJahr / 12;
        const instandhaltung = wohnflaeche * 1; // €/m²/Monat
        const monatlicheGesamtbelastung = monatlicheRate + hausgeld + grundsteuerMonatlich + instandhaltung;
        
        // Calculate Belastungsquote
        const belastungsquote = nettoeinkommen > 0 ? (monatlicheGesamtbelastung / nettoeinkommen) * 100 : 0;
        
        return {
            monatlicheGesamtbelastung,
            monatlicheRate,
            hausgeld,
            grundsteuerMonatlich,
            instandhaltung,
            belastungsquote,
            nettoeinkommen
        };
    }
    
    // Helper function for mobile results (since formatCurrency is in DOMContentLoaded)
    function formatCurrencyMobile(value) {
        return new Intl.NumberFormat('de-DE', { style: 'currency', currency: 'EUR', minimumFractionDigits: 0 }).format(value);
    }
    
    function updateMobileResults(results) {
        // Update main result
        document.getElementById('mobile-monthly-total').textContent = 
            formatCurrencyMobile(results.monatlicheGesamtbelastung) + ' / Monat';
        
        // Update breakdown
        document.getElementById('mobile-result-financing').textContent = 
            formatCurrencyMobile(results.monatlicheRate) + ' / Monat';
        document.getElementById('mobile-result-hausgeld').textContent = 
            formatCurrencyMobile(results.hausgeld) + ' / Monat';
        document.getElementById('mobile-result-grundsteuer').textContent = 
            formatCurrencyMobile(results.grundsteuerMonatlich) + ' / Monat';
        document.getElementById('mobile-result-instandhaltung').textContent = 
            formatCurrencyMobile(results.instandhaltung) + ' / Monat';
        
        // Update verdict
        updateMobileVerdict(results.belastungsquote);
    }
    
    function updateMobileVerdict(belastungsquote) {
        const verdictDiv = document.getElementById('mobile-klartext-result');
        
        let urteilClass, icon, text, beschreibung;
        
        if (belastungsquote < 38) {
            urteilClass = 'urteil-gruen';
            icon = '✅';
            text = currentLanguage === 'de' ? 'Grüner Bereich' : 'Green Zone';
            beschreibung = currentLanguage === 'de' 
                ? 'Das sieht solide aus. Banken bewerten eine solche Quote positiv.'
                : 'This looks solid. Banks rate such a quota positively.';
        } else if (belastungsquote <= 45) {
            urteilClass = 'urteil-gelb';
            icon = '⚠️';
            text = currentLanguage === 'de' ? 'Sportlich' : 'Challenging';
            beschreibung = currentLanguage === 'de'
                ? 'Das ist machbar, aber die Bank wird genau prüfen.'
                : 'This is feasible, but the bank will examine closely.';
        } else {
            urteilClass = 'urteil-rot';
            icon = '🛑';
            text = currentLanguage === 'de' ? 'Kritisch' : 'Critical';
            beschreibung = currentLanguage === 'de'
                ? 'Das ist für die meisten Haushalte nicht tragbar.'
                : 'This is not sustainable for most households.';
        }
        
        verdictDiv.className = `mobile-verdict ${urteilClass}`;
        verdictDiv.innerHTML = `
            <div style="font-size: 3rem; margin-bottom: 1rem;">${icon}</div>
            <div style="font-size: 2rem; font-weight: 700; margin-bottom: 0.5rem;">${belastungsquote.toFixed(1)}%</div>
            <div style="font-size: 1.2rem; font-weight: 600; margin-bottom: 1rem;">${text}</div>
            <div style="font-size: 1rem; line-height: 1.5;">${beschreibung}</div>
        `;
    }
    
    function closeMobileResults() {
        const mobileResults = document.getElementById('mobile-results-page');
        mobileResults.classList.remove('active');
    }
    
    function restartMobileQuiz() {
        closeMobileResults();
        startMobileSteps();
    }
    
    function showMobileContact() {
        showCalendarPopup();
    }
    
    function showCalendarPopup() {
        // Create calendar popup if it doesn't exist
        let calendarPopup = document.getElementById('calendar-popup');
        if (!calendarPopup) {
            calendarPopup = document.createElement('div');
            calendarPopup.id = 'calendar-popup';
            calendarPopup.className = 'calendar-popup-overlay';
            calendarPopup.innerHTML = `
                <div class="calendar-popup-content">
                    <div class="calendar-popup-header">
                        <h3 data-de="Beratungstermin vereinbaren" data-en="Schedule Consultation">Beratungstermin vereinbaren</h3>
                        <button class="calendar-close-btn" onclick="closeCalendarPopup()">&times;</button>
                    </div>
                    <div class="calendar-popup-body">
                        <p data-de="Buchen Sie Ihren kostenlosen Beratungstermin:" data-en="Book your free consultation:">Buchen Sie Ihren kostenlosen Beratungstermin:</p>
                        
                        <!-- LeadConnector Calendar embed -->
                        <div class="calendar-embed-container">
                            <iframe src="https://api.leadconnectorhq.com/widget/booking/kq7NmcLVgdbnxChd37gh" 
                                    style="width: 100%; height: 600px; border: none; overflow: hidden;" 
                                    scrolling="no" 
                                    id="leadconnector-calendar">
                            </iframe>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(calendarPopup);
        }
        
        // Load LeadConnector script if not already loaded
        if (!document.querySelector('script[src*="form_embed.js"]')) {
            const script = document.createElement('script');
            script.src = 'https://link.msgsndr.com/js/form_embed.js';
            script.type = 'text/javascript';
            document.head.appendChild(script);
        }
        
        // Update language
        updateCalendarLanguage();
        
        // Show popup
        calendarPopup.classList.add('active');
        document.body.classList.add('popup-open');
    }
    
    function closeCalendarPopup() {
        const calendarPopup = document.getElementById('calendar-popup');
        if (calendarPopup) {
            calendarPopup.classList.remove('active');
            document.body.classList.remove('popup-open');
        }
    }
    
    
    function updateCalendarLanguage() {
        const calendarPopup = document.getElementById('calendar-popup');
        if (calendarPopup) {
            const elementsWithLang = calendarPopup.querySelectorAll('[data-de]');
            elementsWithLang.forEach(element => {
                const text = element.getAttribute(`data-${currentLanguage}`);
                if (text) {
                    element.textContent = text;
                }
            });
        }
    }
    
    function updateMobileStepLanguage(lang) {
        // Update mobile navigation if open
        const navigation = document.getElementById('mobile-step-navigation');
        if (navigation.classList.contains('active')) {
            showMobileStep(currentStep);
        }
    }
    
    function showMobileValidationError(message) {
        // Entferne vorherige Fehlermeldung falls vorhanden
        hideMobileValidationError();
        
        const stepContent = document.getElementById('step-content');
        const errorDiv = document.createElement('div');
        errorDiv.id = 'mobile-validation-error';
        errorDiv.style.cssText = `
            background-color: #f8d7da;
            border: 1px solid #dc3545;
            color: #721c24;
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1rem;
            font-weight: 600;
        `;
        errorDiv.textContent = message;
        
        stepContent.appendChild(errorDiv);
        
        // Scroll zur Fehlermeldung
        errorDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
    
    function hideMobileValidationError() {
        const errorDiv = document.getElementById('mobile-validation-error');
        if (errorDiv) {
            errorDiv.remove();
        }
    }
    
    function syncInitialLiveValues(clone) {
        // Find all live value elements in the clone and sync them
        const liveValueElements = clone.querySelectorAll('.live-value');
        liveValueElements.forEach(liveValue => {
            const originalId = liveValue.id.replace('mobile-', '');
            const originalLiveValue = document.getElementById(originalId);
            if (originalLiveValue) {
                liveValue.textContent = originalLiveValue.textContent;
            }
        });
    }
    
    function addMobileTooltipListeners(clone) {
        console.log('🔍 addMobileTooltipListeners called for clone:', clone);
        
        // Find all tooltips in the cloned element
        const tooltips = clone.querySelectorAll('.tooltip');
        console.log(`💡 Found ${tooltips.length} tooltips in clone:`, tooltips);
        
        tooltips.forEach((tooltip, index) => {
            console.log(`🎯 Processing tooltip ${index + 1}:`, tooltip);
            
            const tooltipText = tooltip.querySelector('.tooltip-text');
            console.log(`📝 Tooltip text element:`, tooltipText);
            
            if (tooltipText) {
                console.log('✅ Adding click listener to tooltip');
                
                // Add click event for mobile - use higher priority
                tooltip.addEventListener('click', function(e) {
                    console.log('👆 Tooltip clicked!', tooltip);
                    e.preventDefault();
                    e.stopPropagation();
                    e.stopImmediatePropagation();
                    
                    console.log('🔄 Current tooltip visibility:', tooltipText.style.visibility);
                    
                    // Toggle visibility
                    if (tooltipText.style.visibility === 'visible') {
                        console.log('👻 Hiding tooltip');
                        tooltipText.style.visibility = 'hidden';
                        tooltipText.style.opacity = '0';
                    } else {
                        console.log('👁️ Showing tooltip');
                        
                        // Hide all other tooltips first
                        clone.querySelectorAll('.tooltip-text').forEach(otherTooltip => {
                            otherTooltip.style.visibility = 'hidden';
                            otherTooltip.style.opacity = '0';
                        });
                        
                        // Show this tooltip
                        tooltipText.style.visibility = 'visible';
                        tooltipText.style.opacity = '1';
                        
                        console.log('⏰ Setting auto-hide timer (4s)');
                        // Auto-hide after 4 seconds
                        setTimeout(() => {
                            console.log('⏰ Auto-hiding tooltip');
                            tooltipText.style.visibility = 'hidden';
                            tooltipText.style.opacity = '0';
                        }, 4000);
                    }
                });
                
                // Add touch event for better mobile support
                tooltip.addEventListener('touchstart', function(e) {
                    console.log('👆 Tooltip touched!', tooltip);
                    e.preventDefault();
                    tooltip.click();
                });
                
                console.log(`✅ Added listeners to tooltip ${index + 1}`);
            } else {
                console.log(`❌ No tooltip-text found in tooltip ${index + 1}`);
            }
        });
        
        console.log('🏁 Finished adding tooltip listeners');
    }
    
    </script>
    
    <script>
    // Global function für CTA-Form-Handler (muss global sein wegen inline onsubmit)
    function handleCtaSubmit(event, userType) {
        event.preventDefault();
        const email = event.target.email.value;
        
        // Hier könntest du die E-Mail an dein Backend senden
        console.log('CTA Submit:', { email, userType, timestamp: new Date() });
        
        // Feedback für den Nutzer
        const button = event.target.querySelector('button');
        const originalText = button.textContent;
        button.textContent = currentLanguage === 'de' ? 'Vielen Dank!' : 'Thank you!';
        button.disabled = true;
        
        setTimeout(() => {
            button.textContent = originalText;
            button.disabled = false;
            event.target.email.value = '';
        }, 3000);
    }
    </script>

</body>
</html>
