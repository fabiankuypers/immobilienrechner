<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Immobilien Klartext-Kosten-Rechner</title>
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- Chart.js from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        /* --- Grundlegende Stile & Variablen --- */
        :root {
            --bg-color: #F8F9FA;
            --primary-color: #005A9C; /* Seriöses Blau */
            --primary-light: #e6f0f7;
            --text-color: #212529;
            --success-color: #198754; /* Dunkles Grün */
            --warning-color: #FD7E14; /* Warmes Orange */
            --warning-light: #ffe8d4;
            --border-color: #DEE2E6;
            --white: #FFFFFF;
            --font-family: 'Inter', sans-serif;
        }

        /* --- Reset & Body --- */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 2rem 1rem;
        }

        /* --- Hauptcontainer & Layout --- */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: var(--white);
            border-radius: 12px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }

        header {
            padding: 2rem;
            border-bottom: 1px solid var(--border-color);
            text-align: center;
            position: relative;
        }

        header h1 {
            color: var(--primary-color);
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        header p {
            font-size: 1.1rem;
            color: #6c757d;
        }
        
        .rechner-wrapper {
            display: flex;
            flex-wrap: wrap;
        }

        .input-section, .output-section {
            padding: 2rem;
            width: 100%;
        }

        .input-section {
            background-color: #fdfdff;
        }
        
        /* --- Formular-Elemente --- */
        .form-group {
            margin-bottom: 2rem;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .form-group .label-wrapper {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .form-group .live-value {
            font-weight: 700;
            color: var(--primary-color);
            font-size: 1.1rem;
            background-color: var(--primary-light);
            padding: 0.25rem 0.75rem;
            border-radius: 6px;
        }

        .form-group .info-text {
            font-size: 0.85rem;
            color: #6c757d;
            margin-top: 0.25rem;
        }

        input[type="number"], select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            font-family: var(--font-family);
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        input[type="number"]:focus, select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(0, 90, 156, 0.2);
        }

        /* Slider Stile */
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 5px;
            outline: none;
            margin-top: 0.5rem;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: var(--primary-color);
            cursor: pointer;
            border-radius: 50%;
            border: 2px solid var(--white);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: var(--primary-color);
            cursor: pointer;
            border-radius: 50%;
            border: 2px solid var(--white);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        /* Checkbox Stile */
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: 1.25em;
            height: 1.25em;
            accent-color: var(--primary-color);
        }
        
        .makler-provision-rate {
            transition: opacity 0.3s, transform 0.3s;
            transform: translateY(-10px);
            opacity: 0;
            height: 0;
            overflow: hidden;
        }
        
        .makler-provision-rate.visible {
            transform: translateY(0);
            opacity: 1;
            height: auto;
            margin-top: 1rem;
        }

        /* --- Phase 2 (Monatliche Belastung) --- */
        .phase-2 {
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 2px solid var(--border-color);
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s ease;
        }
        
        .phase-2.visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        .phase-2 h3 {
            color: var(--primary-color);
            font-size: 1.3rem;
            margin-bottom: 1.5rem;
            font-weight: 700;
        }
        
        /* Sanierungskosten Checkboxen */
        .sanierung-checkboxes {
            display: grid;
            gap: 1rem;
        }
        
        .sanierung-item {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            transition: all 0.2s ease;
        }
        
        .sanierung-item:hover {
            background-color: #f8f9fa;
        }
        
        .sanierung-item input[type="checkbox"] {
            margin-top: 0.125rem;
        }
        
        .sanierung-details {
            flex: 1;
        }
        
        .sanierung-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        
        .sanierung-cost {
            color: var(--warning-color);
            font-weight: 700;
            font-size: 1.1rem;
        }
        
        /* Tooltips */
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }
        
        .tooltip .info-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 16px;
            height: 16px;
            background-color: var(--primary-color);
            color: white;
            border-radius: 50%;
            font-size: 0.7rem;
            font-weight: bold;
            margin-left: 0.25rem;
        }
        
        .tooltip .tooltip-text {
            visibility: hidden;
            width: 200px;
            background-color: #333;
            color: #fff;
            text-align: left;
            border-radius: 6px;
            padding: 0.5rem;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.8rem;
            line-height: 1.3;
        }
        
        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
        
        /* Warnhinweis */
        .warning-box {
            background-color: var(--warning-light);
            border: 1px solid var(--warning-color);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
            display: none;
        }
        
        .warning-box.visible {
            display: block;
        }
        
        .warning-box .warning-title {
            font-weight: 700;
            color: var(--warning-color);
            margin-bottom: 0.5rem;
        }
        
        /* --- Einkommen & Klartext-Urteil --- */
        .einkommen-section {
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 2px solid var(--border-color);
        }
        
        .einkommen-section h3 {
            color: var(--primary-color);
            font-size: 1.3rem;
            margin-bottom: 1rem;
            font-weight: 700;
        }
        
        .klartext-urteil {
            margin-top: 2rem;
            padding: 2rem;
            border-radius: 12px;
            text-align: center;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s ease;
        }
        
        .klartext-urteil.visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        .belastungsquote {
            font-size: 4rem;
            font-weight: 700;
            margin: 1rem 0;
        }
        
        .urteil-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }
        
        .urteil-text {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }
        
        .urteil-beschreibung {
            font-size: 1rem;
            line-height: 1.5;
            margin-bottom: 1rem;
        }
        
        .zusatz-info {
            font-size: 0.9rem;
            color: #6c757d;
            margin-top: 1rem;
            font-style: italic;
        }
        
        /* Urteil-Farben */
        .urteil-gruen {
            background-color: #d4edda;
            border: 2px solid var(--success-color);
        }
        
        .urteil-gruen .belastungsquote {
            color: var(--success-color);
        }
        
        .urteil-gelb {
            background-color: var(--warning-light);
            border: 2px solid var(--warning-color);
        }
        
        .urteil-gelb .belastungsquote {
            color: var(--warning-color);
        }
        
        .urteil-rot {
            background-color: #f8d7da;
            border: 2px solid #dc3545;
        }
        
        .urteil-rot .belastungsquote {
            color: #dc3545;
        }
        
        /* --- Dynamischer CTA --- */
        .dynamic-cta {
            margin-top: 3rem;
            padding: 2.5rem;
            border-radius: 12px;
            text-align: center;
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.6s ease;
        }
        
        .dynamic-cta.visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        .dynamic-cta h2 {
            font-size: 1.8rem;
            margin-bottom: 1rem;
            font-weight: 700;
        }
        
        .dynamic-cta p {
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 2rem;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .dynamic-cta .form-inline {
            display: flex;
            gap: 1rem;
            max-width: 400px;
            margin: 0 auto;
            flex-wrap: wrap;
        }
        
        .dynamic-cta input[type="email"] {
            flex: 1;
            min-width: 250px;
            padding: 1rem;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
        }
        
        .dynamic-cta button {
            padding: 1rem 2rem;
            border: none;
            border-radius: 8px;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
        }
        
        .cta-gruen {
            background-color: #d4edda;
            border: 2px solid var(--success-color);
        }
        
        .cta-gruen h2 {
            color: var(--success-color);
        }
        
        .cta-gruen button {
            background-color: var(--success-color);
            color: white;
        }
        
        .cta-gruen button:hover {
            background-color: #157347;
            transform: translateY(-2px);
        }
        
        .cta-gelb-rot {
            background-color: var(--warning-light);
            border: 2px solid var(--warning-color);
        }
        
        .cta-gelb-rot h2 {
            color: var(--warning-color);
        }
        
        .cta-gelb-rot button {
            background-color: var(--warning-color);
            color: white;
        }
        
        .cta-gelb-rot button:hover {
            background-color: #e8680a;
            transform: translateY(-2px);
        }

        /* --- Output / Ergebnis-Sektion --- */
        .output-section {
            background-color: var(--white);
            border-left: 1px solid var(--border-color);
        }
        
        .results-summary {
            text-align: center;
            margin-bottom: 2.5rem;
        }
        
        .results-summary h3 {
            font-size: 1rem;
            font-weight: 600;
            color: #6c757d;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .results-summary .total-investment {
            font-size: 3rem;
            font-weight: 700;
            color: var(--success-color);
            margin: 0.5rem 0;
        }
        
        /* --- Reference Costs (Zur Orientierung) --- */
        .reference-costs {
            margin-top: 2rem;
            padding: 1.5rem;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }
        
        .reference-costs h4 {
            font-size: 0.9rem;
            font-weight: 600;
            color: #6c757d;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 1rem;
        }
        
        .reference-costs ul {
            list-style: none;
            padding: 0;
        }
        
        .reference-costs li {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            font-size: 0.9rem;
            color: #6c757d;
        }
        
        .reference-costs .cost-value {
            font-weight: 600;
            color: var(--text-color);
        }
        
        .chart-container {
            position: relative;
            height: 280px;
            width: 280px;
            margin: 0 auto 2.5rem auto;
        }
        
        .cost-breakdown ul {
            list-style: none;
            padding: 0;
        }
        
        .cost-breakdown li {
            display: flex;
            justify-content: space-between;
            padding: 0.75rem 0;
            border-bottom: 1px solid #f1f3f5;
        }
        
        .cost-breakdown li:last-child {
            border-bottom: none;
        }
        
        .cost-breakdown .cost-label {
            color: #495057;
        }
        
        .cost-breakdown .cost-value {
            font-weight: 600;
        }
        
        .cost-breakdown .highlight {
            color: var(--warning-color);
        }
        
        .cost-breakdown .total {
            font-weight: 700;
            font-size: 1.1rem;
            padding-top: 1rem;
        }
        
        .cost-breakdown .final-total .cost-value {
            color: var(--success-color);
        }
        
        hr.divider {
            border: 0;
            height: 1px;
            background-color: var(--border-color);
            margin: 1rem 0;
        }

        /* --- CTA Sektion --- */
        .cta-section {
            background-color: var(--primary-light);
            padding: 2.5rem;
            text-align: center;
            border-top: 1px solid var(--border-color);
        }
        
        .cta-section h2 {
            color: var(--primary-color);
            margin-bottom: 1rem;
        }
        
        .cta-section p {
            max-width: 600px;
            margin: 0 auto 1.5rem auto;
        }
        
        .cta-button {
            display: inline-block;
            background-color: var(--primary-color);
            color: var(--white);
            padding: 0.8rem 2rem;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            transition: background-color 0.2s, transform 0.2s;
            box-shadow: 0 4px 15px rgba(0, 90, 156, 0.2);
        }
        
        .cta-button:hover {
            background-color: #004a80;
            transform: translateY(-2px);
        }
        
        .cta-buyer-form {
            margin-top: 2rem;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .cta-buyer-form p {
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }
        
        .cta-buyer-form .form-inline {
            display: flex;
            gap: 0.5rem;
        }
        
        .cta-buyer-form input[type="email"] {
            flex-grow: 1;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
        }
        
        .cta-buyer-form button {
            background-color: var(--success-color);
            color: var(--white);
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.2s;
        }
        
        .cta-buyer-form button:hover {
            background-color: #146c43;
        }
        
        /* --- Vertrauensfoto & Kalendertermin --- */
        .trust-section {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 2rem;
            margin: 2rem 0 3rem 0;
            flex-wrap: wrap;
            background-color: var(--white);
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }
        
        .trust-photo {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--primary-color);
            box-shadow: 0 4px 15px rgba(0, 90, 156, 0.2);
        }
        
        .calendar-cta {
            text-align: left;
        }
        
        .calendar-button {
            display: block;
            background-color: var(--success-color);
            color: var(--white);
            padding: 1rem 2.5rem;
            border-radius: 8px;
            border: none;
            text-decoration: none;
            font-weight: 600;
            font-size: 1.1rem;
            font-family: var(--font-family);
            cursor: pointer;
            transition: background-color 0.2s, transform 0.2s;
            box-shadow: 0 4px 15px rgba(25, 135, 84, 0.3);
            margin-top: 1rem;
            text-align: center;
            width: 100%;
        }
        
        .calendar-button:hover {
            background-color: #146c43;
            transform: translateY(-2px);
        }
        
        .calendar-text {
            font-size: 1.1rem;
            color: var(--text-color);
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .calendar-subtext {
            font-size: 0.9rem;
            color: #6c757d;
            margin-bottom: 0.5rem;
        }
        
        /* CTA Buttons Layout */
        .cta-buttons-section {
            margin: 2rem 0;
        }
        
        /* --- Language Toggle --- */
        .language-toggle {
            position: absolute;
            top: 1rem;
            right: 1rem;
            display: flex;
            background-color: var(--white);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .language-toggle button {
            background: none;
            border: none;
            padding: 0.5rem 0.75rem;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }
        
        .language-toggle button:hover {
            background-color: var(--primary-light);
        }
        
        .language-toggle button.active {
            background-color: var(--primary-color);
            color: var(--white);
        }
        
        .language-toggle button.active:hover {
            background-color: #004a80;
        }
        
        /* Mobile Language Toggle */
        @media (max-width: 768px) {
            .language-toggle {
                position: static;
                margin: 0 auto 1rem auto;
                width: fit-content;
            }
        }

        /* --- Responsive Design --- */
        @media (min-width: 992px) {
            .rechner-wrapper {
                flex-wrap: nowrap;
            }
            .input-section {
                width: 45%;
                border-right: 1px solid var(--border-color);
            }
            .output-section {
                width: 55%;
                border-left: none;
            }
        }

    </style>
</head>
<body>

    <div class="container">
        <header>
            <div class="language-toggle">
                <button id="lang-de" class="active" onclick="switchLanguage('de')">
                    🇩🇪 DE
                </button>
                <button id="lang-en" onclick="switchLanguage('en')">
                    🇬🇧 EN
                </button>
            </div>
            <h1 data-de="Immobilien Klartext-Kosten-Rechner" data-en="Real Estate Truth Cost Calculator">Immobilien Klartext-Kosten-Rechner</h1>
            <p data-de="Kannst du dir das leisten? Das ist die einzige Frage, die dir die Bank am Ende stellen wird." data-en="Can you afford it? That's the only question the bank will ask you in the end.">Kannst du dir das leisten? Das ist die einzige Frage, die dir die Bank am Ende stellen wird.</p>
        </header>

        <main class="rechner-wrapper">
            <!-- Eingabe-Sektion -->
            <section class="input-section">
                <form id="cost-calculator-form">
                    
                    <div class="form-group">
                        <div class="label-wrapper">
                            <label for="kaufpreis" data-de="Kaufpreis der Immobilie (€)" data-en="Property Purchase Price (€)">Kaufpreis der Immobilie (€)</label>
                            <span id="kaufpreis-value" class="live-value">450.000 €</span>
                        </div>
                        <input type="range" id="kaufpreis" min="100000" max="2000000" step="5000" value="450000">
                    </div>

                    <div class="form-group">
                        <label for="wohnflaeche" data-de="Wohnfläche (m²)" data-en="Living Space (m²)">Wohnfläche (m²)</label>
                        <input type="number" id="wohnflaeche" value="120" placeholder="z.B. 120" data-placeholder-de="z.B. 120" data-placeholder-en="e.g. 120">
                        <p class="info-text" data-de="Wichtig für die Schätzung der Sanierungskosten." data-en="Important for estimating renovation costs.">Wichtig für die Schätzung der Sanierungskosten.</p>
                    </div>

                    <div class="form-group">
                        <div class="label-wrapper">
                            <label for="eigenkapital" data-de="Dein Eigenkapital (€)" data-en="Your Equity (€)">Dein Eigenkapital (€)</label>
                            <span id="eigenkapital-value" class="live-value">80.000 €</span>
                        </div>
                        <input type="range" id="eigenkapital" min="0" max="500000" step="1000" value="80000">
                    </div>

                    <div class="form-group">
                        <label for="bundesland" data-de="Bundesland" data-en="German State">Bundesland</label>
                        <select id="bundesland">
                            <!-- Options will be populated by JS -->
                        </select>
                        <p class="info-text" data-de="Die Grunderwerbsteuer ist je nach Bundesland unterschiedlich hoch." data-en="Property transfer tax varies by German state.">Die Grunderwerbsteuer ist je nach Bundesland unterschiedlich hoch.</p>
                    </div>

                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="mitMakler" checked>
                            <label for="mitMakler" data-de="Ja, mit Makler" data-en="Yes, with real estate agent">Ja, mit Makler</label>
                        </div>
                        <div id="makler-provision-rate-wrapper" class="makler-provision-rate visible">
                            <label for="maklerprovision" data-de="Provisionssatz inkl. MwSt. (%)" data-en="Commission rate incl. VAT (%)">Provisionssatz inkl. MwSt. (%)</label>
                            <input type="number" id="maklerprovision" value="3.57" step="0.01">
                        </div>
                    </div>

                    <div class="form-group">
                        <label data-de="Welche Sanierungen sind nötig?" data-en="Which renovations are needed?">Welche Sanierungen sind nötig?</label>
                        <p class="info-text" data-de="Sei ehrlich zu dir selbst. Das erspart dir böse Überraschungen." data-en="Be honest with yourself. This will save you from nasty surprises.">Sei ehrlich zu dir selbst. Das erspart dir böse Überraschungen.</p>
                        <div class="sanierung-checkboxes" id="sanierung-checkboxes">
                            <!-- Will be populated by JS -->
                        </div>
                    </div>
                    
                    <!-- Phase 2: Monatliche Belastung -->
                    <div class="phase-2" id="phase-2">
                        <h3 data-de="Schritt 2: Ihre monatliche Belastung" data-en="Step 2: Your Monthly Burden">Schritt 2: Ihre monatliche Belastung</h3>
                        
                        <div class="form-group">
                            <div class="label-wrapper">
                                <label for="zinssatz" data-de="Zinssatz (%)" data-en="Interest Rate (%)">Zinssatz (%)
                                    <span class="tooltip">
                                        <span class="info-icon">i</span>
                                        <span class="tooltip-text" data-de="Aktueller Marktzins. Ihre Bank wird Sie hier genau prüfen." data-en="Current market rate. Your bank will examine you closely here.">Aktueller Marktzins. Ihre Bank wird Sie hier genau prüfen.</span>
                                    </span>
                                </label>
                                <span id="zinssatz-value" class="live-value">3.8 %</span>
                            </div>
                            <input type="range" id="zinssatz" min="2.0" max="7.0" step="0.1" value="3.8">
                        </div>
                        
                        <div class="form-group">
                            <div class="label-wrapper">
                                <label for="tilgung" data-de="Anfängliche Tilgung (%)" data-en="Initial Repayment (%)">Anfängliche Tilgung (%)
                                    <span class="tooltip">
                                        <span class="info-icon">i</span>
                                        <span class="tooltip-text" data-de="Mindestens 2% sind heute Standard bei den meisten Banken. Je höher, desto schneller sind Sie schuldenfrei." data-en="At least 2% is standard at most banks today. The higher, the faster you'll be debt-free.">Mindestens 2% sind heute Standard bei den meisten Banken. Je höher, desto schneller sind Sie schuldenfrei.</span>
                                    </span>
                                </label>
                                <span id="tilgung-value" class="live-value">2.0 %</span>
                            </div>
                            <input type="range" id="tilgung" min="1.0" max="5.0" step="0.1" value="2.0">
                        </div>
                        
                        <div class="form-group">
                            <label for="hausgeld" data-de="Hausgeld / Nebenkosten (€/Monat)" data-en="Maintenance Fees / Utilities (€/Month)">Hausgeld / Nebenkosten (€/Monat)
                                <span class="tooltip">
                                    <span class="info-icon">i</span>
                                    <span class="tooltip-text" data-de="Fragen Sie den Makler nach dem Wirtschaftsplan! Rechnen Sie mit ca. 3,50 €/m² bei Wohnungen." data-en="Ask the agent for the management plan! Calculate about €3.50/m² for apartments.">Fragen Sie den Makler nach dem Wirtschaftsplan! Rechnen Sie mit ca. 3,50 €/m² bei Wohnungen.</span>
                                </span>
                            </label>
                            <input type="number" id="hausgeld" value="420" placeholder="z.B. 420" data-placeholder-de="z.B. 420" data-placeholder-en="e.g. 420">
                        </div>
                        
                        <div class="form-group">
                            <label for="grundsteuer" data-de="Grundsteuer (€/Jahr)" data-en="Property Tax (€/Year)">Grundsteuer (€/Jahr)
                                <span class="tooltip">
                                    <span class="info-icon">i</span>
                                    <span class="tooltip-text" data-de="Wird bald neu berechnet. Geben Sie hier den aktuellen Wert ein." data-en="Will be recalculated soon. Enter the current value here.">Wird bald neu berechnet. Geben Sie hier den aktuellen Wert ein.</span>
                                </span>
                            </label>
                            <input type="number" id="grundsteuer" value="800" placeholder="z.B. 800" data-placeholder-de="z.B. 800" data-placeholder-en="e.g. 800">
                        </div>
                    </div>

                </form>
            </section>

            <!-- Ergebnis-Sektion -->
            <section class="output-section">
                <div class="results-summary">
                    <h3 data-de="Ihre monatliche Gesamtbelastung" data-en="Your Total Monthly Burden">Ihre monatliche Gesamtbelastung</h3>
                    <div id="monthly-total-display" class="total-investment">0 € / Monat</div>
                    
                    <!-- Einkommen & Klartext-Urteil -->
                    <div class="einkommen-section">
                        <h3 data-de="Schritt 3: Das Klartext-Urteil" data-en="Step 3: The Truth Judgment">Schritt 3: Das Klartext-Urteil</h3>
                        
                        <div class="form-group">
                            <label for="nettoeinkommen" data-de="Dein monatliches Netto-Haushaltseinkommen (€)" data-en="Your monthly net household income (€)">Dein monatliches Netto-Haushaltseinkommen (€)</label>
                            <input type="number" id="nettoeinkommen" placeholder="z.B. 5200" data-placeholder-de="z.B. 5200" data-placeholder-en="e.g. 5200">
                            <p class="info-text" data-de="Alle Einkommen des Haushalts nach Abzug von Steuern und Sozialabgaben." data-en="All household income after deduction of taxes and social security contributions.">Alle Einkommen des Haushalts nach Abzug von Steuern und Sozialabgaben.</p>
                        </div>
                        
                        <div class="klartext-urteil" id="klartext-urteil">
                            <!-- Wird dynamisch befüllt -->
                        </div>
                        
                        <div class="dynamic-cta" id="dynamic-cta">
                            <!-- Wird dynamisch befüllt -->
                        </div>
                    </div>
                </div>

                <div class="chart-container">
                    <canvas id="cost-chart"></canvas>
                </div>

                <div class="cost-breakdown">
                    <ul>
                        <li><span class="cost-label" data-de="Monatliche Rate (Zins + Tilgung)" data-en="Monthly Rate (Interest + Repayment)">Monatliche Rate (Zins + Tilgung)</span> <span id="summary-monthly-rate" class="cost-value">0 € / Monat</span></li>
                        <li><span class="cost-label" data-de="Hausgeld / Nebenkosten" data-en="Maintenance Fees / Utilities">Hausgeld / Nebenkosten</span> <span id="summary-hausgeld" class="cost-value">0 € / Monat</span></li>
                        <li><span class="cost-label" data-de="Grundsteuer" data-en="Property Tax">Grundsteuer</span> <span id="summary-grundsteuer-monthly" class="cost-value">0 € / Monat</span></li>
                        <li><span class="cost-label" data-de="Instandhaltungsrücklage" data-en="Maintenance Reserve">Instandhaltungsrücklage
                            <span class="tooltip">
                                <span class="info-icon">i</span>
                                <span class="tooltip-text" data-de="Ihr persönlicher Spartopf für zukünftige Reparaturen (z.B. neue Heizung). Banken sehen gerne, dass Sie dies einplanen." data-en="Your personal savings pot for future repairs (e.g. new heating). Banks like to see that you plan for this.">Ihr persönlicher Spartopf für zukünftige Reparaturen (z.B. neue Heizung). Banken sehen gerne, dass Sie dies einplanen.</span>
                            </span>
                        </span> <span id="summary-instandhaltung" class="cost-value">0 € / Monat</span></li>
                        <hr class="divider">
                        <li class="total final-total"><span class="cost-label" data-de="IHRE MONATLICHE GESAMTBELASTUNG" data-en="YOUR TOTAL MONTHLY BURDEN">IHRE MONATLICHE GESAMTBELASTUNG</span> <span id="summary-monthly-total" class="cost-value">0 € / Monat</span></li>
                    </ul>
                </div>
                
                <!-- Zur Orientierung: Anschaffungskosten -->
                <div class="reference-costs">
                    <h4 data-de="Zur Orientierung: Kosten der Anschaffung" data-en="For Reference: Acquisition Costs">Zur Orientierung: Kosten der Anschaffung</h4>
                    <ul>
                        <li><span class="cost-label" data-de="Gesamtkosten der Anschaffung" data-en="Total acquisition costs">Gesamtkosten der Anschaffung</span> <span id="summary-total-acquisition" class="cost-value">0 €</span></li>
                        <li><span class="cost-label" data-de="Daraus Finanzierungsbedarf" data-en="Resulting financing requirement">Daraus Finanzierungsbedarf</span> <span id="summary-finanzierungsbedarf" class="cost-value">0 €</span></li>
                    </ul>
                </div>
            </section>
        </main>
        
        <!-- Fallback CTA für Makler -->
        <footer class="cta-section" id="fallback-cta" style="display: none;">
            <div class="trust-section">
                <img src="fabian-kuypers.webp" alt="Fabian Valoa - Vertrauensfoto" class="trust-photo">
                <div class="calendar-cta">
                    <div class="calendar-text" data-de="Sie sind Makler?" data-en="Are you a real estate agent?">Sie sind Makler?</div>
                    <div class="calendar-subtext" data-de="Lassen Sie uns gemeinsam Ihre Makler-Tools optimieren" data-en="Let's optimize your real estate tools together">Lassen Sie uns gemeinsam Ihre Makler-Tools optimieren</div>
                    <a href="https://api.leadconnectorhq.com/widget/booking/kq7NmcLVgdbnxChd37gh" target="_blank" class="calendar-button" id="calendar-link-de-fallback" data-de="Kostenlose Beratung" data-en="Free Consultation">Kostenlose Beratung</a>
                    <a href="https://api.leadconnectorhq.com/widget/booking/lqxzeVwcGdummhsI026t" target="_blank" class="calendar-button" id="calendar-link-en-fallback" style="display: none;" data-de="Kostenlose Beratung" data-en="Free Consultation">Free Consultation</a>
                </div>
            </div>
            
            <div class="cta-buttons-section">
                <a href="https://valoa.studio" class="cta-button" data-de="Für Makler: So geht's" data-en="For Real Estate Agents: How it works">Für Makler: So geht's</a>
            </div>
        </footer>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        
        // --- DATENOBJEKTE ---
        const grunderwerbsteuerSaetze = {
            "Baden-Württemberg": 5.0, "Bayern": 3.5, "Berlin": 6.0, "Brandenburg": 6.5,
            "Bremen": 5.0, "Hamburg": 5.5, "Hessen": 6.0, "Mecklenburg-Vorpommern": 6.0,
            "Niedersachsen": 5.0, "Nordrhein-Westfalen": 6.5, "Rheinland-Pfalz": 5.0,
            "Saarland": 6.5, "Sachsen": 5.5, "Sachsen-Anhalt": 5.0, "Schleswig-Holstein": 6.5,
            "Thüringen": 5.0
        };

        const sanierungsOptionen = [
            { id: 'heizung', title: 'Heizung erneuern (Pflicht nach GEG bei Kauf!)', cost: 25000 },
            { id: 'fenster', title: 'Fenster (Doppelverglasung, alt)', cost: 15000 },
            { id: 'dach', title: 'Dach dämmen', cost: 20000 },
            { id: 'bad', title: 'Bad sanieren (älter als 20 Jahre)', cost: 12000 },
            { id: 'elektrik', title: 'Elektrik erneuern (2-adrig)', cost: 10000 },
            { id: 'maler', title: 'Malerarbeiten & Böden', cost: 8000 }
        ];
        
        // Konstanten für Berechnungen
        const FAKTOR_INSTANDHALTUNG = 1; // €/m²/Monat
        const NOTARSATZ = 0.02; // 2%
        const SICHERHEITSPUFFER = 0.05; // 5%

        // --- DOM-ELEMENTE ---
        const form = document.getElementById('cost-calculator-form');
        const kaufpreisSlider = document.getElementById('kaufpreis');
        const kaufpreisValue = document.getElementById('kaufpreis-value');
        const wohnflaecheInput = document.getElementById('wohnflaeche');
        const eigenkapitalSlider = document.getElementById('eigenkapital');
        const eigenkapitalValue = document.getElementById('eigenkapital-value');
        const bundeslandSelect = document.getElementById('bundesland');
        const mitMaklerCheckbox = document.getElementById('mitMakler');
        const maklerProvisionRateWrapper = document.getElementById('makler-provision-rate-wrapper');
        const maklerProvisionInput = document.getElementById('maklerprovision');
        const sanierungCheckboxes = document.getElementById('sanierung-checkboxes');
        
        // Phase 2 Elemente
        const phase2 = document.getElementById('phase-2');
        const zinssatzSlider = document.getElementById('zinssatz');
        const zinssatzValue = document.getElementById('zinssatz-value');
        const tilgungSlider = document.getElementById('tilgung');
        const tilgungValue = document.getElementById('tilgung-value');
        const hausgeldInput = document.getElementById('hausgeld');
        const grundsteuerInput = document.getElementById('grundsteuer');
        
        // Phase 3 Elemente (Klartext-Urteil)
        const nettoeinkommenInput = document.getElementById('nettoeinkommen');
        const klartextUrteilDiv = document.getElementById('klartext-urteil');
        const dynamicCtaDiv = document.getElementById('dynamic-cta');
        const fallbackCta = document.getElementById('fallback-cta');
        
        // Output-Elemente
        const monthlyTotalDisplay = document.getElementById('monthly-total-display');
        const summaryMonthlyRate = document.getElementById('summary-monthly-rate');
        const summaryHausgeld = document.getElementById('summary-hausgeld');
        const summaryGrundsteuerMonthly = document.getElementById('summary-grundsteuer-monthly');
        const summaryInstandhaltung = document.getElementById('summary-instandhaltung');
        const summaryMonthlyTotal = document.getElementById('summary-monthly-total');
        const summaryTotalAcquisition = document.getElementById('summary-total-acquisition');
        const summaryFinanzierungsbedarf = document.getElementById('summary-finanzierungsbedarf');
        
        // Chart
        const ctx = document.getElementById('cost-chart').getContext('2d');
        let costChart;

        // --- INITIALISIERUNG ---
        function init() {
            // Dropdowns befüllen
            populateDropdown(bundeslandSelect, Object.keys(grunderwerbsteuerSaetze), 'Nordrhein-Westfalen');
            populateSanierungCheckboxes();

            // Event Listeners hinzufügen
            form.addEventListener('input', calculateAndDisplay);
            form.addEventListener('change', calculateAndDisplay);
            mitMaklerCheckbox.addEventListener('change', toggleMaklerProvision);
            
            // Live-Slider Updates
            kaufpreisSlider.addEventListener('input', updateKaufpreisDisplay);
            eigenkapitalSlider.addEventListener('input', updateEigenkapitalDisplay);
            zinssatzSlider.addEventListener('input', updateZinssatzDisplay);
            tilgungSlider.addEventListener('input', updateTilgungDisplay);
            
            // Einkommen-Input für Klartext-Urteil
            nettoeinkommenInput.addEventListener('input', calculateBelastungsquote);

            // Chart initialisieren
            initializeChart();
            
            // Erste Berechnung durchführen
            calculateAndDisplay();
        }

        function populateDropdown(selectElement, options, defaultValue) {
            options.forEach(option => {
                const optionElement = document.createElement('option');
                optionElement.value = option;
                optionElement.textContent = option;
                if (option === defaultValue) {
                    optionElement.selected = true;
                }
                selectElement.appendChild(optionElement);
            });
        }
        
        function populateSanierungCheckboxes() {
            sanierungsOptionen.forEach(option => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'sanierung-item';
                
                itemDiv.innerHTML = `
                    <input type="checkbox" id="sanierung-${option.id}" name="sanierung" value="${option.id}">
                    <div class="sanierung-details">
                        <div class="sanierung-title">${option.title}</div>
                        <div class="sanierung-cost">+ ${formatCurrency(option.cost)}</div>
                    </div>
                `;
                
                sanierungCheckboxes.appendChild(itemDiv);
            });
        }
        
        function updateKaufpreisDisplay() {
            kaufpreisValue.textContent = formatCurrency(parseFloat(kaufpreisSlider.value));
            checkPhase2Visibility();
        }
        
        function updateEigenkapitalDisplay() {
            eigenkapitalValue.textContent = formatCurrency(parseFloat(eigenkapitalSlider.value));
        }
        
        function updateZinssatzDisplay() {
            zinssatzValue.textContent = parseFloat(zinssatzSlider.value).toFixed(1) + ' %';
        }
        
        function updateTilgungDisplay() {
            tilgungValue.textContent = parseFloat(tilgungSlider.value).toFixed(1) + ' %';
        }
        
        function checkPhase2Visibility() {
            const kaufpreis = parseFloat(kaufpreisSlider.value);
            const wohnflaeche = parseFloat(wohnflaecheInput.value) || 0;
            
            if (kaufpreis > 0 && wohnflaeche > 0) {
                phase2.classList.add('visible');
            } else {
                phase2.classList.remove('visible');
            }
        }
        
        function toggleMaklerProvision() {
            maklerProvisionRateWrapper.classList.toggle('visible', mitMaklerCheckbox.checked);
            calculateAndDisplay();
        }

        // --- BERECHNUNGSLOGIK ---
        function calculateAndDisplay() {
            // 1. Werte aus dem Formular lesen
            const kaufpreis = parseFloat(kaufpreisSlider.value);
            const wohnflaeche = parseFloat(wohnflaecheInput.value) || 0;
            const eigenkapital = parseFloat(eigenkapitalSlider.value);
            const bundesland = bundeslandSelect.value;
            const istMitMakler = mitMaklerCheckbox.checked;
            const maklerSatz = parseFloat(maklerProvisionInput.value) / 100 || 0;
            
            // Phase 2 Werte
            const zinssatz = parseFloat(zinssatzSlider.value) / 100;
            const tilgung = parseFloat(tilgungSlider.value) / 100;
            const hausgeld = parseFloat(hausgeldInput.value) || 0;
            const grundsteuerJahr = parseFloat(grundsteuerInput.value) || 0;

            // 2. Anschaffungskosten berechnen
            const notarKosten = kaufpreis * NOTARSATZ;
            const steuerSatz = grunderwerbsteuerSaetze[bundesland] / 100;
            const grunderwerbsteuer = kaufpreis * steuerSatz;
            const maklerKosten = istMitMakler ? kaufpreis * maklerSatz : 0;
            const nebenkosten = notarKosten + grunderwerbsteuer + maklerKosten;

            // Sanierungskosten aus Checkboxen
            const sanierungskosten = calculateSanierungskosten();

            const zwischensumme = kaufpreis + nebenkosten + sanierungskosten;
            const sicherheitspuffer = zwischensumme * SICHERHEITSPUFFER;
            
            const gesamtInvestition = zwischensumme + sicherheitspuffer;
            const finanzierungsbedarf = Math.max(0, gesamtInvestition - eigenkapital);

            // 3. Monatliche Kosten berechnen
            const monatlicheRate = calculateMonthlyRate(finanzierungsbedarf, zinssatz, tilgung);
            const grundsteuerMonatlich = grundsteuerJahr / 12;
            const instandhaltung = wohnflaeche * FAKTOR_INSTANDHALTUNG;
            const monatlicheGesamtbelastung = monatlicheRate + hausgeld + grundsteuerMonatlich + instandhaltung;

            // 4. Ergebnisse anzeigen
            updateKaufpreisDisplay();
            updateEigenkapitalDisplay();
            updateZinssatzDisplay();
            updateTilgungDisplay();
            checkPhase2Visibility();

            // Haupt-Ergebnisse
            monthlyTotalDisplay.textContent = formatCurrency(monatlicheGesamtbelastung) + ' / Monat';

            // Detail-Aufschlüsselung
            summaryMonthlyRate.textContent = formatCurrency(monatlicheRate) + ' / Monat';
            summaryHausgeld.textContent = formatCurrency(hausgeld) + ' / Monat';
            summaryGrundsteuerMonthly.textContent = formatCurrency(grundsteuerMonatlich) + ' / Monat';
            summaryInstandhaltung.textContent = formatCurrency(instandhaltung) + ' / Monat';
            summaryMonthlyTotal.textContent = formatCurrency(monatlicheGesamtbelastung) + ' / Monat';
            summaryTotalAcquisition.textContent = formatCurrency(gesamtInvestition);
            summaryFinanzierungsbedarf.textContent = formatCurrency(finanzierungsbedarf);
            
            // Hinweis: Warnhinweis wurde in das Klartext-Urteil integriert
            
            // 5. Chart aktualisieren
            updateChart([monatlicheRate, hausgeld, grundsteuerMonatlich, instandhaltung]);
            
            // 6. Prüfe, ob Belastungsquote berechnet werden kann
            if (nettoeinkommenInput.value > 0) {
                calculateBelastungsquote();
            }
        }
        
        function calculateSanierungskosten() {
            let total = 0;
            const checkboxes = document.querySelectorAll('input[name="sanierung"]:checked');
            
            checkboxes.forEach(checkbox => {
                const option = sanierungsOptionen.find(opt => opt.id === checkbox.value);
                if (option) {
                    total += option.cost;
                }
            });
            
            return total;
        }
        
        function calculateMonthlyRate(darlehensbetrag, zinssatz, tilgung) {
            if (darlehensbetrag <= 0) return 0;
            const monatlicheRate = darlehensbetrag * (zinssatz + tilgung) / 12;
            return monatlicheRate;
        }
        
        // --- KLARTEXT-URTEIL FUNKTIONEN ---
        function calculateBelastungsquote() {
            const nettoeinkommen = parseFloat(nettoeinkommenInput.value) || 0;
            
            if (nettoeinkommen <= 0) {
                klartextUrteilDiv.classList.remove('visible');
                dynamicCtaDiv.classList.remove('visible');
                fallbackCta.style.display = 'block';
                return;
            }
            
            // Hole die aktuelle monatliche Gesamtbelastung
            const monatlicheGesamtbelastung = getCurrentMonthlyBurden();
            
            if (monatlicheGesamtbelastung <= 0) {
                return; // Warte bis alle anderen Werte berechnet sind
            }
            
            const belastungsquote = (monatlicheGesamtbelastung / nettoeinkommen) * 100;
            
            // Urteil anzeigen
            showKlartextUrteil(belastungsquote);
            
            // Passenden CTA anzeigen
            showDynamicCta(belastungsquote);
            
            // Fallback CTA verstecken
            fallbackCta.style.display = 'none';
        }
        
        function getCurrentMonthlyBurden() {
            // Hole die aktuellen Werte aus dem Formular
            const kaufpreis = parseFloat(kaufpreisSlider.value);
            const wohnflaeche = parseFloat(wohnflaecheInput.value) || 0;
            const eigenkapital = parseFloat(eigenkapitalSlider.value);
            const bundesland = bundeslandSelect.value;
            const istMitMakler = mitMaklerCheckbox.checked;
            const maklerSatz = parseFloat(maklerProvisionInput.value) / 100 || 0;
            const zinssatz = parseFloat(zinssatzSlider.value) / 100;
            const tilgung = parseFloat(tilgungSlider.value) / 100;
            const hausgeld = parseFloat(hausgeldInput.value) || 0;
            const grundsteuerJahr = parseFloat(grundsteuerInput.value) || 0;

            // Berechne Anschaffungskosten
            const notarKosten = kaufpreis * NOTARSATZ;
            const steuerSatz = grunderwerbsteuerSaetze[bundesland] / 100;
            const grunderwerbsteuer = kaufpreis * steuerSatz;
            const maklerKosten = istMitMakler ? kaufpreis * maklerSatz : 0;
            const nebenkosten = notarKosten + grunderwerbsteuer + maklerKosten;
            const sanierungskosten = calculateSanierungskosten();
            const zwischensumme = kaufpreis + nebenkosten + sanierungskosten;
            const sicherheitspuffer = zwischensumme * SICHERHEITSPUFFER;
            const gesamtInvestition = zwischensumme + sicherheitspuffer;
            const finanzierungsbedarf = Math.max(0, gesamtInvestition - eigenkapital);

            // Berechne monatliche Kosten
            const monatlicheRate = calculateMonthlyRate(finanzierungsbedarf, zinssatz, tilgung);
            const grundsteuerMonatlich = grundsteuerJahr / 12;
            const instandhaltung = wohnflaeche * FAKTOR_INSTANDHALTUNG;
            
            return monatlicheRate + hausgeld + grundsteuerMonatlich + instandhaltung;
        }
        
        function showKlartextUrteil(belastungsquote) {
            let urteilClass, icon, text, beschreibung, zusatzInfo;
            
            if (belastungsquote < 38) {
                // Grüner Bereich
                urteilClass = 'urteil-gruen';
                icon = '✅';
                text = currentLanguage === 'de' ? 'Grüner Bereich' : 'Green Zone';
                beschreibung = currentLanguage === 'de' 
                    ? 'Das sieht solide aus. Banken bewerten eine solche Quote in der Regel positiv.'
                    : 'This looks solid. Banks usually rate such a quota positively.';
                zusatzInfo = '';
            } else if (belastungsquote <= 45) {
                // Gelber Bereich
                urteilClass = 'urteil-gelb';
                icon = '⚠️';
                text = currentLanguage === 'de' ? 'Sportlich' : 'Challenging';
                beschreibung = currentLanguage === 'de'
                    ? 'Das ist machbar, aber die Bank wird sehr genau auf Ihre weiteren Ausgaben und Sicherheiten schauen.'
                    : 'This is feasible, but the bank will look very closely at your other expenses and securities.';
                zusatzInfo = '';
            } else {
                // Roter Bereich
                urteilClass = 'urteil-rot';
                icon = '🛑';
                text = currentLanguage === 'de' ? 'Kritisch' : 'Critical';
                beschreibung = currentLanguage === 'de'
                    ? 'Seien Sie ehrlich: Das ist für die meisten Haushalte nicht tragbar und wird von Banken nur in Ausnahmefällen finanziert.'
                    : 'Be honest: This is not sustainable for most households and is only financed by banks in exceptional cases.';
                zusatzInfo = currentLanguage === 'de'
                    ? 'Hinweis: Hohes Eigenkapital oder zusätzliche Sicherheiten können eine kritische Quote in manchen Fällen ausgleichen. Dies wird individuell von der Bank geprüft.'
                    : 'Note: High equity or additional securities can sometimes compensate for a critical ratio. This is checked individually by the bank.';
            }
            
            klartextUrteilDiv.className = `klartext-urteil visible ${urteilClass}`;
            klartextUrteilDiv.innerHTML = `
                <div class="urteil-icon">${icon}</div>
                <div class="belastungsquote">${belastungsquote.toFixed(1)}%</div>
                <div class="urteil-text">${text}</div>
                <div class="urteil-beschreibung">${beschreibung}</div>
                ${zusatzInfo ? `<div class="zusatz-info">${zusatzInfo}</div>` : ''}
            `;
        }
        
        function showDynamicCta(belastungsquote) {
            let ctaClass, uberschrift, text, buttonText;
            
            if (belastungsquote < 38) {
                // CTA für solvente Käufer
                ctaClass = 'cta-gruen';
                uberschrift = currentLanguage === 'de' ? 'Glückwunsch! Sie sind kaufbereit.' : 'Congratulations! You are ready to buy.';
                text = currentLanguage === 'de'
                    ? 'Ihr Ergebnis zeigt: Sie gehören zu den wenigen Interessenten, die ihre Hausaufgaben gemacht haben. Verschwenden Sie keine Zeit mit Maklern, die das nicht zu schätzen wissen.'
                    : 'Your result shows: You are one of the few prospects who have done their homework. Don\'t waste time with agents who don\'t appreciate that.';
                buttonText = currentLanguage === 'de' ? 'Kontakt anfordern' : 'Request Contact';
            } else {
                // CTA für unsichere Käufer
                ctaClass = 'cta-gelb-rot';
                uberschrift = currentLanguage === 'de' ? 'Das Ergebnis ist ernüchternd? Gut.' : 'The result is sobering? Good.';
                text = currentLanguage === 'de'
                    ? 'Genau das ist der Sinn dieses Rechners: Ehrlichkeit, bevor Zeit und Geld verbrannt werden. Ein Top-Makler verkauft Ihnen keine Träume, sondern findet realistische Lösungen.'
                    : 'That\'s exactly the point of this calculator: honesty before time and money are wasted. A top agent doesn\'t sell you dreams, but finds realistic solutions.';
                buttonText = currentLanguage === 'de' ? 'Kostenlose Erstberatung' : 'Free Initial Consultation';
            }
            
            dynamicCtaDiv.className = `dynamic-cta visible ${ctaClass}`;
            dynamicCtaDiv.innerHTML = `
                <h2>${uberschrift}</h2>
                <p>${text}</p>
                <form action="#" class="form-inline" onsubmit="handleCtaSubmit(event, '${belastungsquote < 38 ? 'solvent' : 'unsicher'}')">
                    <input type="email" name="email" placeholder="${currentLanguage === 'de' ? 'Ihre E-Mail-Adresse' : 'Your email address'}" required>
                    <button type="submit">${buttonText}</button>
                </form>
            `;
        }
        
        // Form-Handler für CTA
        function handleCtaSubmit(event, userType) {
            event.preventDefault();
            const email = event.target.email.value;
            
            // Hier könntest du die E-Mail an dein Backend senden
            console.log('CTA Submit:', { email, userType, timestamp: new Date() });
            
            // Feedback für den Nutzer
            const button = event.target.querySelector('button');
            const originalText = button.textContent;
            button.textContent = currentLanguage === 'de' ? 'Vielen Dank!' : 'Thank you!';
            button.disabled = true;
            
            setTimeout(() => {
                button.textContent = originalText;
                button.disabled = false;
                event.target.email.value = '';
            }, 3000);
        }
        
        // --- CHART FUNKTIONEN ---
        function initializeChart() {
            costChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Finanzierung', 'Hausgeld/Nebenkosten', 'Grundsteuer', 'Instandhaltungsrücklage'],
                    datasets: [{
                        data: [0, 0, 0, 0],
                        backgroundColor: [
                            '#005A9C', // Primärfarbe
                            '#5ba0d8', // Helleres Blau
                            '#FD7E14', // Warnfarbe
                            '#fecba1'  // Helleres Orange
                        ],
                        borderColor: '#FFFFFF',
                        borderWidth: 4,
                        hoverOffset: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '65%',
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                font: {
                                    family: "'Inter', sans-serif"
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed !== null) {
                                        label += formatCurrency(context.parsed) + ' / Monat';
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        function updateChart(data) {
            costChart.data.datasets[0].data = data;
            costChart.update();
        }

        // --- HELPER FUNKTIONEN ---
        function formatCurrency(value) {
            return new Intl.NumberFormat('de-DE', { style: 'currency', currency: 'EUR', minimumFractionDigits: 0 }).format(value);
        }

        // --- Start ---
        init();
    });
    
    // --- LANGUAGE TOGGLE FUNCTIONALITY ---
    let currentLanguage = 'de';
    
    function switchLanguage(lang) {
        currentLanguage = lang;
        
        // Update button states
        document.getElementById('lang-de').classList.toggle('active', lang === 'de');
        document.getElementById('lang-en').classList.toggle('active', lang === 'en');
        
        // Update calendar links visibility
        const calendarDe = document.getElementById('calendar-link-de');
        const calendarEn = document.getElementById('calendar-link-en');
        const calendarDeFallback = document.getElementById('calendar-link-de-fallback');
        const calendarEnFallback = document.getElementById('calendar-link-en-fallback');
        
        if (calendarDe) calendarDe.style.display = lang === 'de' ? 'block' : 'none';
        if (calendarEn) calendarEn.style.display = lang === 'en' ? 'block' : 'none';
        if (calendarDeFallback) calendarDeFallback.style.display = lang === 'de' ? 'block' : 'none';
        if (calendarEnFallback) calendarEnFallback.style.display = lang === 'en' ? 'block' : 'none';
        
        // Update all elements with data-de and data-en attributes
        const elements = document.querySelectorAll('[data-de][data-en]');
        elements.forEach(element => {
            const text = element.getAttribute(`data-${lang}`);
            if (text) {
                element.textContent = text;
            }
        });
        
        // Update placeholders
        const placeholderElements = document.querySelectorAll(`[data-placeholder-${lang}]`);
        placeholderElements.forEach(element => {
            const placeholder = element.getAttribute(`data-placeholder-${lang}`);
            if (placeholder) {
                element.placeholder = placeholder;
            }
        });
        
        // Update chart labels based on language
        updateChartLanguage(lang);
        
        // Re-calculate Klartext-Urteil if visible to update language
        if (klartextUrteilDiv.classList.contains('visible')) {
            calculateBelastungsquote();
        }
    }
    
    function updateChartLanguage(lang) {
        if (typeof costChart !== 'undefined' && costChart) {
            const labels = lang === 'de' 
                ? ['Finanzierung', 'Hausgeld/Nebenkosten', 'Grundsteuer', 'Instandhaltungsrücklage']
                : ['Financing', 'Maintenance Fees/Utilities', 'Property Tax', 'Maintenance Reserve'];
            
            costChart.data.labels = labels;
            costChart.update();
        }
    }
    
    </script>
    
    <script>
    // Global function für CTA-Form-Handler (muss global sein wegen inline onsubmit)
    function handleCtaSubmit(event, userType) {
        event.preventDefault();
        const email = event.target.email.value;
        
        // Hier könntest du die E-Mail an dein Backend senden
        console.log('CTA Submit:', { email, userType, timestamp: new Date() });
        
        // Feedback für den Nutzer
        const button = event.target.querySelector('button');
        const originalText = button.textContent;
        button.textContent = currentLanguage === 'de' ? 'Vielen Dank!' : 'Thank you!';
        button.disabled = true;
        
        setTimeout(() => {
            button.textContent = originalText;
            button.disabled = false;
            event.target.email.value = '';
        }, 3000);
    }
    </script>

</body>
</html>